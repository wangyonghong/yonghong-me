<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="manifest" href="/images/site.webmanifest">
  <meta name="google-site-verification" content="OnjTLbjHCNhb2DmVFSKHIiIT7K6UOcNW4INMAr5XVrg">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yonghong.tech","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.8.1","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"width":360},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":true,"nav":null,"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/config.min.js"></script>
<meta name="description" content="背景某天晚上，美团到店事业群某项系统服务正在进行常规需求的上线。因为在内部的Plus系统发布时，提示inf-bom版本需要升级，于是我们就将inf-bom版本从1.3.9.6 升级至1.4.2.1，如下图1所示：  图1 版本升级 不过，当服务上线后，开始陆续出现了一些更新系统交互日志方面的报警，这属于系统的辅助流程，报警如下方代码所示。我们发现都是跟MyBatis相关的报警，说明在进行类型转换的">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis版本升级引发的线上告警回顾及原理分析">
<meta property="og:url" content="http://yonghong.tech/repost/2020/inf-bom-mybatis/index.html">
<meta property="og:site_name" content="Honng">
<meta property="og:description" content="背景某天晚上，美团到店事业群某项系统服务正在进行常规需求的上线。因为在内部的Plus系统发布时，提示inf-bom版本需要升级，于是我们就将inf-bom版本从1.3.9.6 升级至1.4.2.1，如下图1所示：  图1 版本升级 不过，当服务上线后，开始陆续出现了一些更新系统交互日志方面的报警，这属于系统的辅助流程，报警如下方代码所示。我们发现都是跟MyBatis相关的报警，说明在进行类型转换的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-6e8a4a27586831fe9ee04855c2bd69ff150501-kgRRpZ.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-9e99c9850481a74c53f7c795d3dcc7bb23662-yaBNTv.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-d54db22f4d28d90be1013fe3572cb09240056-Z9sc3D.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-ce0a3c80a1a969401afb9eee6ceec7a3449700-b3UtsT.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-52b982ff627457f57d190697ef38a883640529-ftNDJj.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-fcf12b094fe418ca9696ac5885094fe034877-NUYC90.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-a333daae043824092d8fdf4867732822476964-8xsurz.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-016b41476d3306c2b0609aceed3c7d5a29377-LSD82q.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-4fc3e8c476ef995304001cbeb7c8364c727634-JdpGR9.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-0f563de7db302e7498f5c5d48b0f55ab108990-khF0An.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-53b0419dc111f5cb5785025707f173ab208427-Dagafq.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-ad6d78ea99d4c1a96f492d13fef7416c214168-Qr2pDy.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-fa15fda92d13ba0cd2a97df576dbf429428834-qs3lt3.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-b760df277efcda04462d2f94d168260b323127-6MHk67.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-3e6163357375d436fada0b275f768b65110984-lUwt1L.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-1ef797f5581ce5bafd4b9019b0fbf1ea445131-jrGCbB.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-5a8a8b2e65f82266ea0f0a77b6e12b34226089-Ca77s2.png">
<meta property="og:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-35b1a605bcaabb7aee2ef4de4378fa52637963-nyRxFf.png">
<meta property="article:published_time" content="2020-06-21T14:24:00.000Z">
<meta property="article:modified_time" content="2020-06-21T14:24:00.000Z">
<meta property="article:author" content="Honng">
<meta property="article:tag" content="MyBatis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://up-img.yonghong.tech/pic/2020/06/21-00-25-6e8a4a27586831fe9ee04855c2bd69ff150501-kgRRpZ.png">


<link rel="canonical" href="http://yonghong.tech/repost/2020/inf-bom-mybatis/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://yonghong.tech/repost/2020/inf-bom-mybatis/","path":"repost/2020/inf-bom-mybatis/","title":"MyBatis版本升级引发的线上告警回顾及原理分析"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>MyBatis版本升级引发的线上告警回顾及原理分析 | Honng</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Honng" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Honng</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Stay Hungry. Stay Foolish.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-bell fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">786</span></a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">903</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-list-alt fa-fw"></i>分类<span class="badge">62</span></a></li>
        <li class="menu-item menu-item-开源"><a href="/open-source/" rel="section"><i class="fab fa-github fa-fw"></i>开源</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%83%8C%E6%99%AF"><span class="nav-number">1.</span> <span class="nav-text">背景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8A%A5%E8%AD%A6%E5%8E%9F%E5%9B%A0%E5%AE%9A%E4%BD%8D"><span class="nav-number">2.</span> <span class="nav-text">报警原因定位</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90"><span class="nav-number">3.</span> <span class="nav-text">详细分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MyBatis%E5%8D%87%E7%BA%A73-2-4%E7%89%88%E6%9C%AC%E7%9A%84%E5%AE%98%E6%96%B9Release%E5%85%AC%E5%91%8A"><span class="nav-number">3.1.</span> <span class="nav-text">MyBatis升级3.2.4版本的官方Release公告</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A5%E7%89%88%E6%9C%AC3-2-3%E4%B8%BA%E4%BE%8B%EF%BC%8CMyBatis%E6%9E%84%E5%BB%BASQL%E8%AF%AD%E5%8F%A5%E8%BF%87%E7%A8%8B%E7%9A%84%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="nav-number">3.2.</span> <span class="nav-text">以版本3.2.3为例，MyBatis构建SQL语句过程的原理分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A5%E7%89%88%E6%9C%AC3-2-4%E4%B8%BA%E4%BE%8B%EF%BC%8C%E7%9B%B8%E6%AF%94%E7%89%88%E6%9C%AC3-2-3%EF%BC%8CMyBatis%E6%9E%84%E5%BB%BASQL%E8%AF%AD%E5%8F%A5%E8%BF%87%E7%A8%8B%E7%9A%84%E5%8F%98%E5%8C%96%E5%88%86%E6%9E%90"><span class="nav-number">3.3.</span> <span class="nav-text">以版本3.2.4为例，相比版本3.2.3，MyBatis构建SQL语句过程的变化分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">5.</span> <span class="nav-text">参考资料</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%9C%E8%80%85%E7%AE%80%E4%BB%8B"><span class="nav-number">6.</span> <span class="nav-text">作者简介</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Honng"
      src="/images/logo.jpg">
  <p class="site-author-name" itemprop="name">Honng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">786</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">62</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">903</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dhbmd5b25naG9uZw==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangyonghong"><i class="fab fa-github fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnlvbmdob25nd2FuZ0AxNjMuY29t" title="E-Mail → mailto:yonghongwang@163.com"><i class="fa fa-envelope fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXR0ZXIuaW0vd2FuZ3lvbmdob25n" title="Gitter → https:&#x2F;&#x2F;gitter.im&#x2F;wangyonghong"><i class="fab fa-gitter fa-fw"></i></span>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dhbmd5b25naG9uZy95b25naG9uZy1tZQ==" title="yonghong-me" aria-label="yonghong-me"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yonghong.tech/repost/2020/inf-bom-mybatis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo.jpg">
      <meta itemprop="name" content="Honng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Honng">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MyBatis版本升级引发的线上告警回顾及原理分析
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-21 22:24:00 22:24:00" itemprop="dateCreated datePublished" datetime="2020-06-21T22:24:00+08:00">2020-06-21 22:24:00</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BD%AC%E8%BD%BD/" itemprop="url" rel="index"><span itemprop="name">转载</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>
<div class="post-meta">
<span id="jinrishici-sentence">正在加载今日诗词....</span>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8" defer></script>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>某天晚上，美团到店事业群某项系统服务正在进行常规需求的上线。因为在内部的Plus系统发布时，提示inf-bom版本需要升级，于是我们就将inf-bom版本从1.3.9.6 升级至1.4.2.1，如下图1所示：</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-6e8a4a27586831fe9ee04855c2bd69ff150501-kgRRpZ.png" alt="图1 版本升级"></p>
<p>图1 版本升级</p>
<p>不过，当服务上线后，开始陆续出现了一些更新系统交互日志方面的报警，这属于系统的辅助流程，报警如下方代码所示。我们发现都是跟MyBatis相关的报警，说明在进行类型转换的时候，系统产生了强转错误。</p>


<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">更新开票请求返回日志, id:&#123;#######&#125;, response:&#123;&#123;&quot;code&quot;:XXX,&quot;data&quot;:&#123;&quot;callType&quot;:3,&quot;code&quot;:XXX,&quot;msg&quot;:&quot;XXXX&quot;,&quot;shopId&quot;:XXXXX,&quot;taxPlateDockType&quot;:&quot;XXXXXXX&quot;&#125;,&quot;msg&quot;:&quot;XXXXX&quot;,&quot;success&quot;:XXXX&#125;&#125;</span><br><span class="line">nested execption is org.apache.ibatis.type.TypeException: Could not set parameters for mapping: ParameterMapping&#123;property=&#x27;updateTime&#x27;, mode=IN, javaType=class java.lang.String,</span><br><span class="line">jdbcTyp=null,resultMapId=&#x27;null&#x27;,jdbcTypeName=&#x27;null&#x27;,expression=&#x27;null&#x27;&#125;.Cause org.apache.ibatis.type.TypeException,Error setting non null parameter #2 with JdbcType null. Try setting a</span><br><span class="line">different Jdbc Type for this parameter or a different configuration property.Cause java.lang.ClassCastException:java.time.LocalDateTime cannot be cast to java.lang.String</span><br></pre></td></tr></table></figure>



<p>因为报警这一块代码，属于历史功能，如果失败并不会影响主流程。但在定位期间，如果频繁报警的话，就会造成一定的干扰。因此，我们马上采取了回滚操作，将inf-bom的版本回滚至历史版本，直至报警消失，然后再进行问题的定位和分析。以下章节就是我们对报警原因的定位及原因详细分析的介绍，希望这些思路能够对大家有所启发和帮助。</p>
<span id="more"></span>

<h2 id="报警原因定位"><a href="#报警原因定位" class="headerlink" title="报警原因定位"></a>报警原因定位</h2><p>在回滚完毕后，我们开始具体分析报警产生的主要原因，于是进行了以下几步的排查。</p>
<p>第一步，查看了报警的Mapper方法，如下代码段所示。这个是接收返回参数，根据主键id，更新具体响应内容和时间的代码，入参有3个，类型分别为long、String和LocalDateTime。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">int</span> <span class="selector-tag">updateResponse</span>(<span class="variable">@Param</span>(<span class="string">&quot;id&quot;</span>)long id, <span class="variable">@Param</span>(<span class="string">&quot;response&quot;</span>)String response, <span class="variable">@Param</span>(<span class="string">&quot;updateTime&quot;</span>)LocalDateTime updateTime);</span><br></pre></td></tr></table></figure>

<p>第二步，我们查看了Mapper方法对应的XML文件，如下代码段所示，对应的parameterType类型是String，而实际参数的类型包括long、String以及LocalDateTime。</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateResponse&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">UPDATE invoice_log</span></span><br><span class="line"><span class="xml">  SET response = #</span><span class="template-variable">&#123;response&#125;</span><span class="xml">, update_time = #</span><span class="template-variable">&#123;updateTime&#125;</span></span><br><span class="line"><span class="xml">WHERE id = #</span><span class="template-variable">&#123;id&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>第三步，我们查看了MyBatis上线前后的版本，报警的内容是：MyBatis在处理SQL语句时，发现不能将LocalDateTime转型为String，这一段逻辑在上线前是可以正常运行的，并且上线的业务逻辑对这段历史代码无改动。因此，我们猜测是因为inf-bom的升级，从而导致MyBatis的版本发生了变化，对某些历史功能不再支持了。MyBatis版本上线前后的变化如下表所示：</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-9e99c9850481a74c53f7c795d3dcc7bb23662-yaBNTv.png" alt="表1 MyBatis版本升级前后对比"></p>
<p>表1 MyBatis版本升级前后对比</p>
<p>第四步，我们通过第三步可以得到，在这次inf-bom的版本升级中，MyBatis的版本直接升了两个大版本，因此我们可以基本将原因猜测为MyBatis升级跨度较大，导致部分历史功能没有兼容支持，从而引起线上SQL的更新报错。</p>
<p>第五步，为了具体验证第四步的想法，我们通过UT的方式，将MyBatis的版本不断从3.4.6往下降，直至没有报错的位置。最终的定位是：当MyBatis版本为3.2.3时，线上代码是正常可用的，但只要升一个版本，也就是自3.2.4开始，就开始不兼容目前的用法。不过，我们当时的思路并不是很好，应该从小版本逐个往上升或者使用二分法，可以加速定位版本的效率。</p>
<p>最后，我们定位到了产生报警的根本问题。总的来说，MyBatis版本由inf-bom引入而来，inf-bom从3.2.3 升级到了3.4.6版本，而MyBatis自3.2.4开始就不支持目前系统内的SQL Mapper的用法，因此在升级后，线上就出现了频繁报警的问题。</p>
<p>问题已经定位，但是还有很多事情我们需要弄清楚。为什么版本升级后就不兼容历史的用法？具体是哪一块内容不兼容？背后的原理又是什么？下文，我们会详细进行分析。</p>
<h2 id="详细分析"><a href="#详细分析" class="headerlink" title="详细分析"></a>详细分析</h2><h3 id="MyBatis升级3-2-4版本的官方Release公告"><a href="#MyBatis升级3-2-4版本的官方Release公告" class="headerlink" title="MyBatis升级3.2.4版本的官方Release公告"></a>MyBatis升级3.2.4版本的官方Release公告</h3><p>首先，从报错的原因上来看，请注意这句话：“Caused by: java.lang.ClassCastException: java.lang.LocalDateTime cannot be cast to java.lang.String.”MyBatis在构建SQL语句时，发现时间字段类型LocalDateTime不能强制转为String类型。而这个SQL对应的XML配置在3.2.3的版本是可以正常使用的，那么我们先从MyBatis的Release Log上查看3.2.4版本到底发生了什么变化。</p>
<blockquote>
<p>An special remark about this feature. Previous versions ignored the “parameterType” attribute and used the actual parameter to calculate bindings. This version builds the binding information during startup and the “parameterType” attribute is used if present (though it is still optional), so in case you had a wrong value for it you will have to change it.</p>
</blockquote>
<p>从官网的Release Log可以看到，MyBatis在3.2.4以前的版本，会忽略XML中的parameterType这个属性，并且使用真实的变量类型进行值的处理。但在3.2.4及以后的版本中，这个属性就被启用了，如果出现类型不匹配的话，就会出现转型失败的报错。这也提示我们开发者，在升级版本时，需要检查系统内的XML配置，使类型进行匹配，或者不设置该属性，让MyBatis自行进行计算。</p>
<p>根据以上内容，我们可以了解到，在版本升级后，MyBatis在构建SQL语句，在获取字段值时的逻辑发生了变化。接下来我们将通过一个简单的示例，来了解一下MyBatis在获取字段值这一块的具体代码流程是怎样的，以3.2.3版本为例。</p>
<h3 id="以版本3-2-3为例，MyBatis构建SQL语句过程的原理分析"><a href="#以版本3-2-3为例，MyBatis构建SQL语句过程的原理分析" class="headerlink" title="以版本3.2.3为例，MyBatis构建SQL语句过程的原理分析"></a>以版本3.2.3为例，MyBatis构建SQL语句过程的原理分析</h3><p>我们看一下配置，首先定义一个通过主键id获取学生信息的方法，仿造系统内的历史代码，我们将parameterType定义为java.lang.String，这和方法对应的参数int并不相同。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">public</span> StudentEntity getStudentById(@Param(&quot;id&quot;) <span class="type">int</span> id);</span><br><span class="line">&lt;<span class="keyword">select</span> id=&quot;getStudentById&quot; parameterType=&quot;java.lang.String&quot; resultType=&quot;entity.StudentEntity&quot;&gt;</span><br><span class="line"><span class="keyword">SELECT</span> id,<span class="type">name</span>,age <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id = #&#123;id&#125;</span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure>

<p>MyBatis框架要做的事情，就是在运行getStudentById(2)的时候，将 #{id}进行替换，使SQL语句变成SELECT id,name,age FROM student WHERE id = 2。MyBatis要将SQL语句完整替换成带参数值的版本，需要经历框架初始化以及实际运行时动态替换这两个部分。因为MyBatis的代码非常多，接下来我们主要阐释和本次案例相关的内容。</p>
<p>在框架初始化阶段，主要包括以下流程，如下图2所示：</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-d54db22f4d28d90be1013fe3572cb09240056-Z9sc3D.png" alt="图2 框架初始化流程"></p>
<p>图2 框架初始化流程</p>
<p>在框架初始化阶段，有一些组件会被构建，逐一做个简单的介绍：</p>
<ul>
<li><strong>SqlSession</strong>：作为MyBatis工作的主要顶层API，表示和数据库交互的会话，完成必要的数据库增删改查功能。</li>
<li><strong>数据库增删改查功能</strong>：负责根据用户传递的parameterObject，动态地生成SQL语句，将信息封装到BoundSql对象中，并返回。</li>
<li><strong>Configuration</strong>：MyBatis所有的配置信息都维持在Configuration对象之中。</li>
</ul>
<p>接下来，我们主要关注SqlSource，这个类会负责生成SQL语句，这也是本次案例中，3.2.3和3.2.4差异比较大的一个地方。下面，我们会介绍一些源码。</p>
<p>在构建Configuration的过程中，会涉及到构建对应每一条SQL语句对应的MappedStatement，parameterTypeClass就是根据我们在XML配置中写的parameterType转换而来，值为java.lang.String，在构建SqlSource时，传入这个参数。如下图3所示：</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-ce0a3c80a1a969401afb9eee6ceec7a3449700-b3UtsT.png" alt="图3 SqlSource依赖参数"></p>
<p>图3 SqlSource依赖参数</p>
<p>在SqlSource的构建中，parameterType参数其实是被忽略不用的，并没有继续往下传递，这跟官方的描述是一致的。因为3.2.4之前这个parameterType属性被忽略了，然后就创建了DynamicSqlSource，这个类主要是用于处理MyBatis动态SQL的类。如下图4所示：</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-52b982ff627457f57d190697ef38a883640529-ftNDJj.png" alt="图4 SqlSource构建"></p>
<p>图4 SqlSource构建</p>
<p>在框架初始化的阶段，需要介绍的内容，在3.2.3版本已经介绍完毕。当执行getStudentById方法时，MyBatis的流程如下图5所示。因受限于图片长度，我们对布局进行了一些调整：</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-fcf12b094fe418ca9696ac5885094fe034877-NUYC90.png" alt="图5 运行流程"></p>
<p>图5 运行流程</p>
<p>在具体执行阶段，也涉及到一些组件，我们需要做简单的了解：</p>
<ul>
<li><strong>SqlSession</strong>：作为MyBatis工作的主要顶层API，表示和数据库交互的会话，完成必要数据库增删改查功能。</li>
<li><strong>Executor</strong>：MyBatis执行器，这是MyBatis调度的核心，负责SQL语句的生成和查询缓存的维护。</li>
<li><strong>BoundSql</strong>：表示动态生成的SQL语句以及相应的参数信息。</li>
<li><strong>StatementHandler</strong>：封装了JDBC Statement操作，负责对JDBC statement的操作，如设置参数、将Statement结果集转换成List集合等等。</li>
<li><strong>ParameterHandler</strong>：负责对用户传递的参数转换成JDBC Statement 所需要的参数。</li>
<li><strong>TypeHandler</strong>：负责Java数据类型和JDBC数据类型之间的映射和转换。</li>
</ul>
<p>我们主要关注获取BoundSql以及参数化语句的流程，这也是3.2.3和3.2.4差异比较大的一个地方。在进入Executor的Query方法后，会首先通过对应的MappedStatement来获取BoundSql，用来帮助我们动态生成SQL语句，里面绑定了对应的SQL以及参数映射关系。在构建框架阶段，我们使用的SqlSource是DynamicSqlSource，通过这个类来生成获取BoundSql，如下图6所示：</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-a333daae043824092d8fdf4867732822476964-8xsurz.png" alt="图6 获取BoundSql"></p>
<p>图6 获取BoundSql</p>
<p>通过图6的代码，我们可以得知，parameterType在初始化阶段未被使用，而是在SQL执行时获取到的，但获取到的类型是parameterObject对应的类型，这个类是用来记录Mapper方法上对应的参数。如下图7所示，它并非在SQL配置文件中标注的java.lang.String。</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-016b41476d3306c2b0609aceed3c7d5a29377-LSD82q.png" alt="图7 parameterObject类型"></p>
<p>图7 parameterObject类型</p>
<p>然后我们通过SqlSourceBuilder的parse方法对SQL以及获取到的类型进行再次处理，其中的流程代码比较长。在这个过程中，我们主要去构建SQL的参数和Java类型的绑定关系，MyBatis依赖这个绑定关系，使用对应的TypeHandler去进行值的转换。</p>
<p>调用链路是<code>SqlSourceParser.parse -&gt; 内部类 ParameterMappingTokenHandler.handleToken -&gt; 私有方法 buildParameterMapping</code>，如下图8中的代码所示。因为当前的parameterType为MapperMethod$ParamMap，经过了多个if判断，判定当前property id的propertyType为Object.class类型。接下来，构建SQL的参数和Java类型的绑定关系ParameterMapping，再进行返回。</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-4fc3e8c476ef995304001cbeb7c8364c727634-JdpGR9.png" alt="图8 buildParameterMapping过程"></p>
<p>图8 buildParameterMapping过程</p>
<p>构建完成的ParameterMapping的结构如下图9中的代码所示，参数id对应的javaType类型为java.lang.Object，对应的TypeHander处理器为UnknownTypeHandler，也就是未找到合适的TypeHandler的兜底选项。</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-0f563de7db302e7498f5c5d48b0f55ab108990-khF0An.png" alt="图9 ParameterMapping结构"></p>
<p>图9 ParameterMapping结构</p>
<p>接下来，流程就会流转到Executor，在<code>org.apache.ibatis.executor.SimpleExecutor#doQuery</code>进行查询时，会根据当前的SQL类型，生成对应的StatementHandler。因为我们目前都是用的预编译SQL，因此生成的statementHandler就是PreparedStatementHandler，熟悉JDBC的小伙伴应该马上可以猜到对应的语句是什么类型了。然后，我们对这句SQL语句进行填充，如下图10中的代码所示。我们会通过PreparedStatementHandler的parameterize方法对Statement进行参数化，也就是进行填充。</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-53b0419dc111f5cb5785025707f173ab208427-Dagafq.png" alt="图10 PrepareStatement处理过程"></p>
<p>图10 PrepareStatement处理过程</p>
<p>在PreparedStatementHandler进行参数化时，会将参数化的职责交给DefaultParameterHandler处理。如下图11中的代码所示，我们主要关注红线部分，首先会获取ParameterMapping对应的TypeHander，如前文所述，获取到的是UnknownTypeHandler，然后会通过setParameter方法，将参数id替换成对应的值。</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-ad6d78ea99d4c1a96f492d13fef7416c214168-Qr2pDy.png" alt="img"></p>
<p>在Typehandler的流程里，首先会进入BaseTypeHandler，然后在具体设置时，会进入子类的方法。在UnknownTypeHandler，首先会再次对参数parameter进行解析，判断最正确的TypeHandler类型，如下图12中的代码所示:</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-fa15fda92d13ba0cd2a97df576dbf429428834-qs3lt3.png" alt="图12 获取可用TypeHandler"></p>
<p>图12 获取可用TypeHandler</p>
<p>在resolveTypeHandler方法中，因为已知了参数值的类型，通过Integer这个class在typeHandlerRegistry中寻找对应的TypeHandler，TypeHandlerRegistry是MyBatis启动时内置好的，代表Java对象类型和TypeHandler的映射关系，有兴趣的同学可以进入这个类详细看下。在这个例子中，我们会直接获取到IntegerHandler，如下图13中的代码所示:</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-b760df277efcda04462d2f94d168260b323127-6MHk67.png" alt="图13 获取IntegerHandler"></p>
<p>图13 获取IntegerHandler</p>
<p>在获取到IntegerHandler后，我们就可以使用IntegerTypeHandler的setInt方法，对SQL语句中的参数进行替换。如图14中的代码所示，SQL语句被成功替换：</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-3e6163357375d436fada0b275f768b65110984-lUwt1L.png" alt="图14 IntegerHander值替换"></p>
<p>图14 IntegerHander值替换</p>
<p>后续就是执行SQL并处理返回结果，这就不在本文的讨论范围内了。从上文的分析中，我们可以了解到，在3.2.3及以下版本，MyBatis会忽略parameterType，在真正进行SQL转换时，重新根据SQL方法入参类型，然后计算合适的TypeHandler处理器，所以本案例中的代码在3.2.3版本时，它在运行时是正常的。</p>
<h3 id="以版本3-2-4为例，相比版本3-2-3，MyBatis构建SQL语句过程的变化分析"><a href="#以版本3-2-4为例，相比版本3-2-3，MyBatis构建SQL语句过程的变化分析" class="headerlink" title="以版本3.2.4为例，相比版本3.2.3，MyBatis构建SQL语句过程的变化分析"></a>以版本3.2.4为例，相比版本3.2.3，MyBatis构建SQL语句过程的变化分析</h3><p>在前一章节中，我们得知MyBatis在运行SQL阶段重新计算参数对应的TypeHandler，然后进行SQL参数的替换。那么，在版本3.2.4中，MyBatis做了什么改动，从而导致了原有的使用方式变得不可用呢？从官方的Release Log来看，版本3.2.4做了这样的一个改动。</p>
<blockquote>
<p>This version builds the binding information during startup and the “parameterType” attribute is used</p>
</blockquote>
<p>这个意思是说：parameterType会在框架初始化阶段阶段就被使用到。我们将分析的重点放在构建阶段，因为负责处理绑定关系的BoundSql由配置阶段的SqlSource生成，我们主要查看SqlSource的构建，在3.2.4中发生了什么变化。如图15所示，与3.2.3不同，3.2.4首先判断了是否为动态SQL，在非动态SQL情况下，才会将parameterType java.lang.String作为参数，传入SqlSource的构造方法。</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-1ef797f5581ce5bafd4b9019b0fbf1ea445131-jrGCbB.png" alt="图15 生成SqlSource"></p>
<p>图15 生成SqlSource</p>
<p>而后续流程与3.2.3一致，因为parameter类型为java.lang.String，在构建parameterMapping时，使用的类型就是java.lang.String。</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-5a8a8b2e65f82266ea0f0a77b6e12b34226089-Ca77s2.png" alt="图16 构建ParameterMapping与3.2.3版本的差异"></p>
<p>图16 构建ParameterMapping与3.2.3版本的差异</p>
<p>因为在框架初始化阶段，SqlSource的ParameterMapping中id对应的类型就是java.lang.String，这就导致在进行SQL语句的替换时，获取到的TypeHandler是StringTypeHandler，如下图17所示：</p>
<p><img src="https://up-img.yonghong.tech/pic/2020/06/21-00-25-35b1a605bcaabb7aee2ef4de4378fa52637963-nyRxFf.png" alt="图17  整数类型的参数获取到了StringTypeHandler"></p>
<p>图17 整数类型的参数获取到了StringTypeHandler</p>
<p>后面的报错原因就比较好理解了，在调用StringTypeHandler的setString方法时，报出了<code>java.lang.ClassCastException: java.lang.Integer cannot be cast to java.lang.String</code>的错误。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我们总结一下这个案例因：</p>
<p>MyBatis 3.2.3版本支持parameterType和实际参数类型不匹配，在执行SQL阶段，动态计算值处理器类型。在大版本升级2个版本号后，parameterType实际的类型开始生效，使用对应这个类型的TypeHandler对SQL进行参数替换，会导致Mapper方法中的参数和XML中的parameterType不匹配时，进而会出现类型转换报错。</p>
<p>这一段排查的经历，对自己后续编写代码及在系统上线时也有一些启发，主要包括以下几个方面：</p>
<ul>
<li>在inf-bom升级时，需要线下进行全面回归，要避免框架存在不兼容的用法，不然的话，就容易导致线上错误。</li>
<li>开发同学可以检查自己系统内的MyBatis版本，如果是3.2.4以下，需要全面检查下现在的Mapper文件里对于parameterType的使用和Mapper方法中实际的参数类型是否一致，避免升级到3.2.4及以上版本时发生转型报错。如果有不匹配的情况存在，需要进行修正或者不使用parameterType，让MyBatis在运行SQL时自动计算对应的类型。</li>
<li>可以考虑使用MyBatis-Generator来自动生成XML和Mapper文件，毕竟是专业团队在维护，稳定性相对来说会更好一些，同时能够避免手动修改XML文件带来的误操作。</li>
<li>可以主动关注强依赖的一些开源框架的Release Log，不要错过了重要的信息。</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81ZGI5MmM0MWYyNjVkYTRkMGE2OGQxNjE=">带你一步一步手撕 MyBatis 源码加手绘流程图——构建部分<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81ZGJlMzUyODZmYjlhMDIwNWQ1NjI5NDI=">带你一步一步手撕 MyBatis 源码加手绘流程图——执行部分<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81ZTUzNTVmNzZmYjlhMDdjZDAwZDgwNjY=">MyBatis源码解析（三）—缓存篇<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81ZTM1MGQ4OTUxODgyNTRkZmQ0M2RlZjU=">面试官问你MyBatis SQL是如何执行的？把这篇文章甩给他<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81ZTAzZjdkNWU1MWQ0NTU4MzYxNWFiM2U=">源码分析(1.4万字) MyBatis接口没有实现类为什么可以执行增删改查<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL215YmF0aXMvbXliYXRpcy0zL2NvbXBhcmUvbXliYXRpcy0zLjIuMy4uLm15YmF0aXMtMy4yLjQjZGlmZi03ODhjMTcwOGQ2MjI1ODI2ZjU5YzIzNDRjOTI2N2Y3MQ==">MyBatis/MyBatis-3/Comparing changes<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h2 id="作者简介"><a href="#作者简介" class="headerlink" title="作者简介"></a>作者简介</h2><p>凯伦，2016年校招加入美团，后端开发工程师。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpg" alt="Honng 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipay.jpg" alt="Honng 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Honng
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://yonghong.tech/repost/2020/inf-bom-mybatis/" title="MyBatis版本升级引发的线上告警回顾及原理分析">http://yonghong.tech/repost/2020/inf-bom-mybatis/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="/atom.xml">
          <span class="icon">
            <i class="fa fa-rss"></i>
          </span>

          <span class="label">RSS</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/MyBatis/" rel="tag"># MyBatis</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/repost/2020/spring-transaction/" rel="prev" title="Spring事务的传播特性">
                  <i class="fa fa-chevron-left"></i> Spring事务的传播特性
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/repost/2020/select-poll-epoll/" rel="next" title="Linux IO模式及 select、poll、epoll详解">
                  Linux IO模式及 select、poll、epoll详解 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-disqus">disqus</a></li>
            <li class="tab"><a href="#comment-gitalk">gitalk</a></li>
            <li class="tab"><a href="#comment-livere">livere</a></li>
            <li class="tab"><a href="#comment-utterances">utterances</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane disqus" id="comment-disqus">
              
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
            </div>
            <div class="tab-pane gitalk" id="comment-gitalk">
              <div class="comments gitalk-container"></div>
            </div>
            <div class="tab-pane livere" id="comment-livere">
              <div class="comments" id="lv-container" data-id="city" data-uid="MTAyMC81MTYxMi8yODA5Mw=="></div>
            </div>
            <div class="tab-pane utterances" id="comment-utterances">
              <div class="comments utterances-container"></div>
            </div>
        </div>
      </div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yonghong</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">1.4m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">21:37</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div><div>
由 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & <a target="_blank" rel="noopener" href="https://theme-next.js.org/">NexT.Gemini</a> & <a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" style="border: none;"><img src="/images/upyun.png" alt="又拍云" width="80px" style="display: inline; vertical-align: middle;"/></a>强力驱动
</div>
<div id="beian">
  <a href="https://beian.miit.gov.cn" rel="noopener external nofollow noreferrer" target="_blank" class="exturl" title="">京 ICP 备 18012168 号</a>
</div>
<script>
  var domain = document.domain;
  if (domain == 'localhost') {
    document.getElementById('beian').getElementsByTagName('a')[0].innerText = '京ICP备 18012168号';
  }
  if (domain == '0xl2oot.cn') {
    document.getElementById('beian').getElementsByTagName('a')[0].innerText = '京ICP备 18012168号-1';
  }
  if (domain == 'www.0xl2oot.cn') {
    document.getElementById('beian').getElementsByTagName('a')[0].innerText = '京ICP备 18012168号-1';
  }
  if (domain == 'yonghong.tech') {
    document.getElementById('beian').getElementsByTagName('a')[0].innerText = '京ICP备 18012168号-5';
  }
  if (domain == 'www.yonghong.tech') {
    document.getElementById('beian').getElementsByTagName('a')[0].innerText = '京ICP备 18012168号-5';
  }
</script>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/comments.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/next-boot.min.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/search/local-search.min.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.13.3/dist/mermaid.min.js","integrity":"sha256-blHXaX2RMvNwEOnrYOl/6/RKqNi97Ig3o6Ae3bhXPvM="}}</script>
  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/tags/mermaid.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/fancybox.min.js"></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/math/mathjax.min.js"></script>


  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.2.0/dist/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"http://yonghong.tech/repost/2020/inf-bom-mybatis/"}</script>
  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/quicklink.min.js"></script>
<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"yonghong-tech","count":false,"i18n":{"disqus":"disqus"}}</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/comments/disqus.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"wangyonghong","repo":"gitalk","client_id":"0e42a09d2799751b9ba7","client_secret":"3e04e5109cf9e3cc34d68deb668842c9c5139846","admin_user":"wangyonghong","distraction_free_mode":true,"proxy":"https://codeyq.com/gitalk-proxy/login/oauth/access_token","language":null,"js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"},"path_md5":"df516cd1b568c689f36f0d072cd9915f"}</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/comments/gitalk.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/comments/livere.min.js"></script>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"wangyonghong/gitalk","issue_term":"pathname","theme":"github-light"}</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/comments/utterances.min.js"></script>
<script src="//unpkg.com/rxjs/bundles/rxjs.umd.min.js"></script>
<script>
const { range } = rxjs;
const { map, filter, debounceTime } = rxjs.operators;

const shiftPress$ = rxjs.fromEvent(document, 'keydown')
  .pipe(
    filter(({ key }) => key === 'Shift')
  )
  

const shiftDoublePress$ = shiftPress$.pipe(debounceTime(600))

shiftDoublePress$.subscribe(count => {
  console.log('双击shift，激活搜索框')
  const event = new MouseEvent('click', {
    view: window,
    bubbles: true,
    cancelable: true
  })
  const searchDiv = document.getElementsByClassName('popup-trigger')[0];
  searchDiv.dispatchEvent(event)
})
</script>

</body>
</html>
