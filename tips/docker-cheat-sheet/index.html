<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="manifest" href="/images/site.webmanifest">
  <meta name="google-site-verification" content="OnjTLbjHCNhb2DmVFSKHIiIT7K6UOcNW4INMAr5XVrg">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yonghong.tech","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.8.1","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"width":360},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":true,"nav":null,"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/config.min.js"></script>
<meta name="description" content="https:&#x2F;&#x2F;github.com&#x2F;wsargent&#x2F;docker-cheat-sheet 目录 为何使用 Docker 系统环境(Prerequisites) 安装(Installation) 容器(Containers) 镜像(Images) 网络(Networks) 仓管中心和仓库(Registry &amp; Repository) Dockerfile 层(Layers) 链接(Lin">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker Cheat Sheet">
<meta property="og:url" content="http://yonghong.tech/tips/docker-cheat-sheet/index.html">
<meta property="og:site_name" content="Honng">
<meta property="og:description" content="https:&#x2F;&#x2F;github.com&#x2F;wsargent&#x2F;docker-cheat-sheet 目录 为何使用 Docker 系统环境(Prerequisites) 安装(Installation) 容器(Containers) 镜像(Images) 网络(Networks) 仓管中心和仓库(Registry &amp; Repository) Dockerfile 层(Layers) 链接(Lin">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-11-25T14:24:00.000Z">
<meta property="article:modified_time" content="2021-11-25T14:24:00.000Z">
<meta property="article:author" content="Honng">
<meta property="article:tag" content="技巧">
<meta property="article:tag" content="速查">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://yonghong.tech/tips/docker-cheat-sheet/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://yonghong.tech/tips/docker-cheat-sheet/","path":"tips/docker-cheat-sheet/","title":"Docker Cheat Sheet"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Docker Cheat Sheet | Honng</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Honng" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Honng</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Stay Hungry. Stay Foolish.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-bell fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">793</span></a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">910</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-list-alt fa-fw"></i>分类<span class="badge">62</span></a></li>
        <li class="menu-item menu-item-开源"><a href="/open-source/" rel="section"><i class="fab fa-github fa-fw"></i>开源</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">1.</span> <span class="nav-text">目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BD%95%E4%BD%BF%E7%94%A8-Docker"><span class="nav-number">2.</span> <span class="nav-text">为何使用 Docker</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83"><span class="nav-number">3.</span> <span class="nav-text">系统环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux"><span class="nav-number">3.1.</span> <span class="nav-text">Linux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MacOS"><span class="nav-number">3.2.</span> <span class="nav-text">MacOS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E7%89%88%E6%9C%AC"><span class="nav-number">3.3.</span> <span class="nav-text">检查版本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">4.</span> <span class="nav-text">安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux-1"><span class="nav-number">4.1.</span> <span class="nav-text">Linux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#macOS"><span class="nav-number">4.2.</span> <span class="nav-text">macOS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8-Container"><span class="nav-number">5.</span> <span class="nav-text">容器(Container)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-number">5.1.</span> <span class="nav-text">生命周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E5%92%8C%E5%81%9C%E6%AD%A2"><span class="nav-number">5.2.</span> <span class="nav-text">启动和停止</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CPU-%E9%99%90%E5%88%B6"><span class="nav-number">5.2.1.</span> <span class="nav-text">CPU 限制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E9%99%90%E5%88%B6"><span class="nav-number">5.2.2.</span> <span class="nav-text">内存限制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%83%BD%E5%8A%9B-Capabilities"><span class="nav-number">5.2.3.</span> <span class="nav-text">能力(Capabilities)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF"><span class="nav-number">5.3.</span> <span class="nav-text">信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5-%E5%AF%BC%E5%87%BA"><span class="nav-number">5.4.</span> <span class="nav-text">导入 &#x2F; 导出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="nav-number">5.5.</span> <span class="nav-text">执行命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%95%9C%E5%83%8F-Images"><span class="nav-number">6.</span> <span class="nav-text">镜像(Images)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-1"><span class="nav-number">6.1.</span> <span class="nav-text">生命周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E5%AE%83%E4%BF%A1%E6%81%AF"><span class="nav-number">6.2.</span> <span class="nav-text">其它信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%85%E7%90%86"><span class="nav-number">6.3.</span> <span class="nav-text">清理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD-%E4%BF%9D%E5%AD%98%E9%95%9C%E5%83%8F"><span class="nav-number">6.4.</span> <span class="nav-text">加载 &#x2F; 保存镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5-%E5%AF%BC%E5%87%BA%E5%AE%B9%E5%99%A8"><span class="nav-number">6.5.</span> <span class="nav-text">导入 &#x2F; 导出容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E5%B7%B2%E4%BF%9D%E5%AD%98%E7%9A%84%E9%95%9C%E5%83%8F-%E4%B8%8E-%E5%AF%BC%E5%85%A5%E5%B7%B2%E5%AF%BC%E5%87%BA%E4%B8%BA%E9%95%9C%E5%83%8F%E7%9A%84%E5%AE%B9%E5%99%A8-%E7%9A%84%E4%B8%8D%E5%90%8C"><span class="nav-number">6.6.</span> <span class="nav-text">加载已保存的镜像 与 导入已导出为镜像的容器 的不同</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C-Networks"><span class="nav-number">7.</span> <span class="nav-text">网络(Networks)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-2"><span class="nav-number">7.1.</span> <span class="nav-text">生命周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E5%AE%83%E4%BF%A1%E6%81%AF-1"><span class="nav-number">7.2.</span> <span class="nav-text">其它信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5"><span class="nav-number">7.3.</span> <span class="nav-text">建立连接</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%93%E7%AE%A1%E4%B8%AD%E5%BF%83%E5%92%8C%E4%BB%93%E5%BA%93-Registry-amp-Repository"><span class="nav-number">8.</span> <span class="nav-text">仓管中心和仓库(Registry &amp; Repository)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E4%BB%93%E7%AE%A1%E4%B8%AD%E5%BF%83"><span class="nav-number">8.1.</span> <span class="nav-text">本地仓管中心</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dockerfile"><span class="nav-number">9.</span> <span class="nav-text">Dockerfile</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4"><span class="nav-number">9.1.</span> <span class="nav-text">指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%99%E7%A8%8B"><span class="nav-number">9.2.</span> <span class="nav-text">教程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90"><span class="nav-number">9.3.</span> <span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B1%82-Layers"><span class="nav-number">10.</span> <span class="nav-text">层(Layers)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5-Links"><span class="nav-number">11.</span> <span class="nav-text">链接(Links)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%B7%E6%A0%87-Volumes"><span class="nav-number">12.</span> <span class="nav-text">卷标(Volumes)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-3"><span class="nav-number">12.1.</span> <span class="nav-text">生命周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF-1"><span class="nav-number">12.2.</span> <span class="nav-text">信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9A%B4%E9%9C%B2%E7%AB%AF%E5%8F%A3-Exposing-ports"><span class="nav-number">13.</span> <span class="nav-text">暴露端口(Exposing ports)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">14.</span> <span class="nav-text">最佳实践</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E5%85%A8-Security"><span class="nav-number">15.</span> <span class="nav-text">安全(Security)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E6%8F%90%E7%A4%BA"><span class="nav-number">15.1.</span> <span class="nav-text">安全提示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4-User-Namespaces"><span class="nav-number">15.2.</span> <span class="nav-text">用户命名空间(User Namespaces)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3%E8%A7%86%E9%A2%91"><span class="nav-number">15.3.</span> <span class="nav-text">安全相关视频</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E8%B7%AF%E7%BA%BF%E5%9B%BE"><span class="nav-number">15.4.</span> <span class="nav-text">安全路线图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E8%B4%B4%E5%A3%AB"><span class="nav-number">16.</span> <span class="nav-text">小贴士</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%85%E7%90%86-1"><span class="nav-number">16.1.</span> <span class="nav-text">清理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#df-%E5%91%BD%E4%BB%A4"><span class="nav-number">16.2.</span> <span class="nav-text">df 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Heredoc-%E5%A3%B0%E6%98%8E-Docker-%E5%AE%B9%E5%99%A8"><span class="nav-number">16.3.</span> <span class="nav-text">Heredoc 声明 Docker 容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E8%BF%91%E4%B8%80%E6%AC%A1%E7%9A%84%E5%AE%B9%E5%99%A8-ID"><span class="nav-number">16.4.</span> <span class="nav-text">最近一次的容器 ID</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%A6%E5%91%BD%E4%BB%A4%E7%9A%84%E6%8F%90%E4%BA%A4%EF%BC%88%E9%9C%80%E8%A6%81-Dockerfile%EF%BC%89"><span class="nav-number">16.5.</span> <span class="nav-text">带命令的提交（需要 Dockerfile）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96-IP-%E5%9C%B0%E5%9D%80"><span class="nav-number">16.6.</span> <span class="nav-text">获取 IP 地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"><span class="nav-number">16.7.</span> <span class="nav-text">获取端口映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D%E5%AE%B9%E5%99%A8"><span class="nav-number">16.8.</span> <span class="nav-text">通过正则匹配容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE"><span class="nav-number">16.9.</span> <span class="nav-text">获取环境变量配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BA%E8%A1%8C%E7%BB%88%E6%AD%A2%E8%BF%90%E8%A1%8C%E4%B8%AD%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="nav-number">16.10.</span> <span class="nav-text">强行终止运行中的容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E5%AE%B9%E5%99%A8%EF%BC%88%E5%BC%BA%E8%A1%8C%E5%88%A0%E9%99%A4%EF%BC%81%E6%97%A0%E8%AE%BA%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%88%96%E5%81%9C%E6%AD%A2%EF%BC%89"><span class="nav-number">16.11.</span> <span class="nav-text">删除所有容器（强行删除！无论容器运行或停止）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%97%A7%E5%AE%B9%E5%99%A8"><span class="nav-number">16.12.</span> <span class="nav-text">删除旧容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E5%B7%B2%E5%81%9C%E6%AD%A2%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="nav-number">16.13.</span> <span class="nav-text">删除已停止的容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%81%9C%E6%AD%A2%E5%B9%B6%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8"><span class="nav-number">16.14.</span> <span class="nav-text">停止并删除容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%97%A0%E7%94%A8-dangling-%E7%9A%84%E9%95%9C%E5%83%8F"><span class="nav-number">16.15.</span> <span class="nav-text">删除无用 (dangling) 的镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E9%95%9C%E5%83%8F"><span class="nav-number">16.16.</span> <span class="nav-text">删除所有镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%97%A0%E7%94%A8-dangling-%E7%9A%84%E5%8D%B7%E6%A0%87"><span class="nav-number">16.17.</span> <span class="nav-text">删除无用 (dangling) 的卷标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F%E4%BE%9D%E8%B5%96"><span class="nav-number">16.18.</span> <span class="nav-text">查看镜像依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-%E5%AE%B9%E5%99%A8%E7%98%A6%E8%BA%AB"><span class="nav-number">16.19.</span> <span class="nav-text">Docker 容器瘦身</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%91%E8%A7%86%E8%BF%90%E8%A1%8C%E4%B8%AD%E5%AE%B9%E5%99%A8%E7%9A%84%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E5%88%A9%E7%94%A8%E7%8E%87"><span class="nav-number">16.20.</span> <span class="nav-text">监视运行中容器的系统资源利用率</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86%E6%96%87%E4%BB%B6%E6%8C%82%E8%BD%BD%E4%B8%BA%E5%8D%B7%E6%A0%87"><span class="nav-number">16.21.</span> <span class="nav-text">将文件挂载为卷标</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Honng"
      src="/images/logo.jpg">
  <p class="site-author-name" itemprop="name">Honng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">793</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">62</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">910</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dhbmd5b25naG9uZw==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangyonghong"><i class="fab fa-github fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnlvbmdob25nd2FuZ0AxNjMuY29t" title="E-Mail → mailto:yonghongwang@163.com"><i class="fa fa-envelope fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXR0ZXIuaW0vd2FuZ3lvbmdob25n" title="Gitter → https:&#x2F;&#x2F;gitter.im&#x2F;wangyonghong"><i class="fab fa-gitter fa-fw"></i></span>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dhbmd5b25naG9uZy95b25naG9uZy1tZQ==" title="yonghong-me" aria-label="yonghong-me"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yonghong.tech/tips/docker-cheat-sheet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo.jpg">
      <meta itemprop="name" content="Honng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Honng">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Docker Cheat Sheet
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-25 22:24:00 22:24:00" itemprop="dateCreated datePublished" datetime="2021-11-25T22:24:00+08:00">2021-11-25 22:24:00</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E5%B7%A7/" itemprop="url" rel="index"><span itemprop="name">技巧</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>
<div class="post-meta">
<span id="jinrishici-sentence">正在加载今日诗词....</span>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8" defer></script>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>12 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dzYXJnZW50L2RvY2tlci1jaGVhdC1zaGVldA==">https://github.com/wsargent/docker-cheat-sheet<i class="fa fa-external-link-alt"></i></span></p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li><a href="#%E4%B8%BA%E4%BD%95%E4%BD%BF%E7%94%A8-docker">为何使用 Docker</a></li>
<li><a href="#%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83">系统环境(Prerequisites)</a></li>
<li><a href="#%E5%AE%89%E8%A3%85">安装(Installation)</a></li>
<li><a href="#%E5%AE%B9%E5%99%A8container">容器(Containers)</a></li>
<li><a href="#%E9%95%9C%E5%83%8Fimages">镜像(Images)</a></li>
<li><a href="#%E7%BD%91%E7%BB%9Cnetworks">网络(Networks)</a></li>
<li><a href="#%E4%BB%93%E7%AE%A1%E4%B8%AD%E5%BF%83%E5%92%8C%E4%BB%93%E5%BA%93registry--repository">仓管中心和仓库(Registry &amp; Repository)</a></li>
<li><a href="#dockerfile">Dockerfile</a></li>
<li><a href="#%E5%B1%82layers">层(Layers)</a></li>
<li><a href="#%E9%93%BE%E6%8E%A5links">链接(Links)</a></li>
<li><a href="#%E5%8D%B7%E6%A0%87volumes">卷标(Volumes)</a></li>
<li><a href="#%E6%9A%B4%E9%9C%B2%E7%AB%AF%E5%8F%A3exposing-ports">暴露端口(Exposing Ports)</a></li>
<li><a href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">最佳实践(Best Practices)</a></li>
<li><a href="#%E5%AE%89%E5%85%A8security">安全(security)</a></li>
<li><a href="#%E5%B0%8F%E8%B4%B4%E5%A3%AB">小贴士(Tips)</a></li>
<li><a href="#%E8%B4%A1%E7%8C%AE%E6%89%8B%E5%86%8Ccontributing">贡献手册(Contributing)</a></li>
</ul>
<span id="more"></span>

<h2 id="为何使用-Docker"><a href="#为何使用-Docker" class="headerlink" title="为何使用 Docker"></a>为何使用 Docker</h2><p>「通过 Docker，开发者可以使用任何语言任何工具创建任何应用。“Dockerized” 的应用是完全可移植的，能在任何地方运行 - 不管是同事的 OS X 和 Windows 笔记本，或是在云端运行的 Ubuntu QA 服务，还是在虚拟机运行的 Red Hat 产品数据中心。</p>
<p>Docker Hub 上有 13000+ 的应用，开发者可以从中选取一个进行快速扩展开发。Docker 跟踪管理变更和依赖关系，让系统管理员能更容易理解开发人员是如何让应用运转起来的。而开发者可以通过 Docker Hub 的共有/私有仓库，构建他们的自动化编译，与其他合作者共享成果。</p>
<p>Docker 帮助开发者更快地构建和发布高质量的应用。」—— <span class="exturl" data-url="aHR0cHM6Ly93d3cuZG9ja2VyLmNvbS93aGF0LWRvY2tlci8jY29weTE=">什么是 Docker<i class="fa fa-external-link-alt"></i></span></p>
<h2 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h2><p>我用的是 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JvYmJ5cnVzc2VsbC9vaC1teS16c2g=">Oh My Zsh<i class="fa fa-external-link-alt"></i></span> 和 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JvYmJ5cnVzc2VsbC9vaC1teS16c2gvd2lraS9QbHVnaW5zI2RvY2tlcg==">Docker 插件<i class="fa fa-external-link-alt"></i></span>，它可以自动补全 Docker 命令。你的环境可能有所不同。</p>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>Docker 对于 Linux 内核版本的 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL2luc3RhbGxhdGlvbi9iaW5hcmllcy8jY2hlY2sta2VybmVsLWRlcGVuZGVuY2llcw==">最低要求<i class="fa fa-external-link-alt"></i></span> 为 <code>3.10.x</code>。</p>
<h3 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a>MacOS</h3><p>10.8「Mountain Lion」或更新版本。</p>
<h3 id="检查版本"><a href="#检查版本" class="headerlink" title="检查版本"></a>检查版本</h3><p>时刻关注你当前正在使用的 Docker 版本是十分重要的，这能够帮助你了解可用的特性。同时，可以让你在查找镜像时选择使用的版本。接下来让我们看看如何操作。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/version/"><code>docker version</code></a> 查看你正在运行的 Docker 版本。</li>
</ul>
<p>获取 Docker 服务版本：</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">$ docker version --format &#x27;</span><span class="template-variable">&#123;&#123;<span class="name">.Server.Version</span>&#125;&#125;</span><span class="xml">&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">1.8.0</span></span><br></pre></td></tr></table></figure>

<p>你也可以输出原始的 JSON 数据：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">version</span> <span class="comment">--format &#x27;&#123;&#123;json .&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;Client&quot;</span>:&#123;<span class="string">&quot;Version&quot;</span>:<span class="string">&quot;1.8.0&quot;</span>,<span class="string">&quot;ApiVersion&quot;</span>:<span class="string">&quot;1.20&quot;</span>,<span class="string">&quot;GitCommit&quot;</span>:<span class="string">&quot;f5bae0a&quot;</span>,<span class="string">&quot;GoVersion&quot;</span>:<span class="string">&quot;go1.4.2&quot;</span>,<span class="string">&quot;Os&quot;</span>:<span class="string">&quot;linux&quot;</span>,<span class="string">&quot;Arch&quot;</span>:<span class="string">&quot;am&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="Linux-1"><a href="#Linux-1" class="headerlink" title="Linux"></a>Linux</h3><p>Docker 官方提供了快速、易用的安装脚本：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL http<span class="variable">s:</span>//<span class="built_in">get</span>.docker.<span class="keyword">com</span>/ | <span class="keyword">sh</span></span><br></pre></td></tr></table></figure>

<p>如果你不想执行一个不明不白的 Shell 脚本，那么请看 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL2luc3RhbGxhdGlvbi9saW51eC8=">安装说明<i class="fa fa-external-link-alt"></i></span>，选择你在用的发行版本。</p>
<p>如果你是一个 Docker 超新手，那么你应当先去看看 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL2dldHN0YXJ0ZWQv">系列教程<i class="fa fa-external-link-alt"></i></span>。</p>
<h3 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h3><p>下载并安装 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZG9ja2VyLmNvbS9jb21tdW5pdHktZWRpdGlvbg==">Docker Community Edition<i class="fa fa-external-link-alt"></i></span>。如果你在使用 Homebrew-Cask，只需在命令行输入 <code>brew cask install docker</code> 即可。下载安装 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vdG9vbGJveC9vdmVydmlldy8=">Docker Toolbox<i class="fa fa-external-link-alt"></i></span> 亦可。<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZG9ja2VyLWZvci1tYWMv">Docker For Mac<i class="fa fa-external-link-alt"></i></span> 很赞，但是它的安装过程与 VirtualBox 不太一样。详情请查阅 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZG9ja2VyLWZvci1tYWMvZG9ja2VyLXRvb2xib3gv">比较<i class="fa fa-external-link-alt"></i></span>。</p>
<blockquote>
<p><strong>注意</strong>：Docker Toolbox 已经过时。你应当使用 Docker Community Edition，详见 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vdG9vbGJveC9vdmVydmlldy8=">Docker Toolbox<i class="fa fa-external-link-alt"></i></span></p>
</blockquote>
<p>安装好 Docker Community Edition 后，点击 Launchpad 内的 Docker 图标。接着即可启动容器了：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> hello-world</span><br></pre></td></tr></table></figure>

<p>好了，现在你有了一个运行中的 Docker 容器了。</p>
<h2 id="容器-Container"><a href="#容器-Container" class="headerlink" title="容器(Container)"></a>容器(Container)</h2><p><span class="exturl" data-url="aHR0cDovL2V0aGVyZWFsbWluZC5jb20vYmFzaWNzLWRvY2tlci1jb250YWluZXJzLWh5cGVydmlzb3JzLWNvcmVvcy8=">关于 Docker 进程隔离的基础<i class="fa fa-external-link-alt"></i></span>。容器 (Container) 之于虚拟机 (Virtual Machine) 就好比线程之于进程。或者你可以把他们想成是「吃了类固醇的 chroots」。</p>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/create"><code>docker create</code></a> 创建容器但不启动它。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/rename/"><code>docker rename</code></a> 用于重命名容器。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/run"><code>docker run</code></a> 一键创建并同时启动该容器。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/rm"><code>docker rm</code></a> 删除容器。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/update/"><code>docker update</code></a> 调整容器的资源限制。</li>
</ul>
<p>通常情况下，不使用任何命令行选项启动一个容器，该容器将会立即启动并停止。若需保持其运行，你可以使用 <code>docker run -td container_id</code> 命令。选项 <code>-t</code> 表示分配一个 pseudo-TTY 会话，<code>-d</code> 表示自动将容器与终端分离（也就是说在后台运行容器，并输出容器 ID）。</p>
<p>如果你需要一个临时容器，可使用 <code>docker run --rm</code> 会在容器停止之后删除它。</p>
<p>如果你需要映射宿主机 (host) 的目录到 Docker 容器内，可使用 <code>docker run -v $HOSTDIR:$DOCKERDIR</code>。详见 <a href="#%E5%8D%B7%E6%A0%87volumes">卷标(Volumes)</a> 一节。</p>
<p>如果你想同时删除与容器相关联的卷标，那么在删除容器的时候必须包含 <code>-v</code> 选项，像这样 <code>docker rm -v</code>。</p>
<p>从 Docker 1.10 起，其内置一套各容器独立的 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL2FkbWluL2xvZ2dpbmcvb3ZlcnZpZXcv">日志引擎<i class="fa fa-external-link-alt"></i></span>，每个容器可以独立使用。你可以使用 <code>docker run --log-driver=syslog</code> 来自定义日志引擎（例如以上的 <code>syslog</code>）。</p>
<h3 id="启动和停止"><a href="#启动和停止" class="headerlink" title="启动和停止"></a>启动和停止</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/start"><code>docker start</code></a> 启动已存在的容器。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/stop"><code>docker stop</code></a> 停止运行中的容器。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/restart"><code>docker restart</code></a> 重启容器。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/pause/"><code>docker pause</code></a> 暂停运行中的容器，将其「冻结」在当前状态。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/unpause/"><code>docker unpause</code></a> 结束容器暂停状态。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/wait"><code>docker wait</code></a> 阻塞地等待某个运行中的容器直到停止。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/kill"><code>docker kill</code></a> 向运行中的容器发送 SIGKILL 指令。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/attach"><code>docker attach</code></a> 连接到运行中的容器。</li>
</ul>
<p>如果你想将容器的端口 (ports) 暴露至宿主机，请见 <a href="#%E6%9A%B4%E9%9C%B2%E7%AB%AF%E5%8F%A3exposing-ports">暴露端口</a> 一节。</p>
<p>关于 Docker 实例崩溃后的重启策略，详见 <span class="exturl" data-url="aHR0cDovL2NvbnRhaW5lcjQyLmNvbS8yMDE0LzA5LzMwL2RvY2tlci1yZXN0YXJ0LXBvbGljaWVzLw==">本文<i class="fa fa-external-link-alt"></i></span>。</p>
<h4 id="CPU-限制"><a href="#CPU-限制" class="headerlink" title="CPU 限制"></a>CPU 限制</h4><p>你可以限制 CPU 资源占用，无论是指定百分比，或是特定核心数。</p>
<p>例如，你可以设置 <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/run/#/cpu-share-constraint"><code>cpu-shares</code></a>。该配置看起来有点奇怪 – 1024 表示 100% CPU，因此如果你希望容器使用所有 CPU 内核的 50%，应将其设置为 512：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> -ti <span class="comment">--c 512 agileek/cpuset-test</span></span><br></pre></td></tr></table></figure>

<p>更多信息请参阅 <span class="exturl" data-url="aHR0cHM6Ly9nb2xkbWFubi5wbC9ibG9nLzIwMTQvMDkvMTEvcmVzb3VyY2UtbWFuYWdlbWVudC1pbi1kb2NrZXIvI19jcHU=">https://goldmann.pl/blog/2014/09/11/resource-management-in-docker/#_cpu<i class="fa fa-external-link-alt"></i></span>。</p>
<p>通过 <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/run/#/cpuset-constraint"><code>cpuset-cpus</code></a> 可使用特定 CPU 内核。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> -ti <span class="attribute">--cpuset-cpus</span>=0,4,6 agileek/cpuset-test</span><br></pre></td></tr></table></figure>

<p>请参阅 <span class="exturl" data-url="aHR0cHM6Ly9hZ2lsZWVrLmdpdGh1Yi5pby9kb2NrZXIvMjAxNC8wOC8wNi9kb2NrZXItY3B1c2V0Lw==">https://agileek.github.io/docker/2014/08/06/docker-cpuset/<i class="fa fa-external-link-alt"></i></span> 获取更多细节以及一些不错的视频。</p>
<p>注意，Docker 在容器内仍然能够 <strong>看到</strong> 全部 CPU – 它仅仅是不使用全部而已。请参阅 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvY2tlci9kb2NrZXIvaXNzdWVzLzIwNzcw">https://github.com/docker/docker/issues/20770<i class="fa fa-external-link-alt"></i></span> 获取更多细节。</p>
<h4 id="内存限制"><a href="#内存限制" class="headerlink" title="内存限制"></a>内存限制</h4><p>同样，亦可给 Docker 设置 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9ydW4vIy91c2VyLW1lbW9yeS1jb25zdHJhaW50cw==">内存限制<i class="fa fa-external-link-alt"></i></span>：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> run -it -m <span class="number">300</span>M ubuntu:<span class="number">14</span>.<span class="number">04</span> /bin/bash</span><br></pre></td></tr></table></figure>

<h4 id="能力-Capabilities"><a href="#能力-Capabilities" class="headerlink" title="能力(Capabilities)"></a>能力(Capabilities)</h4><p>Linux 的 Capability 可以通过使用 <code>cap-add</code> 和 <code>cap-drop</code> 设置。请参阅 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9ydW4vIy9ydW50aW1lLXByaXZpbGVnZS1hbmQtbGludXgtY2FwYWJpbGl0aWVz">https://docs.docker.com/engine/reference/run/#/runtime-privilege-and-linux-capabilities<i class="fa fa-external-link-alt"></i></span> 获取更多细节。这有助于提高安全性。</p>
<p>如需要挂载基于 FUSE 的文件系统，你需要结合 <code>--cap-add</code> 和 <code>--device</code> 使用：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run <span class="params">--rm</span> -it <span class="params">--cap-add</span> SYS_ADMIN <span class="params">--device</span> <span class="string">/dev/fuse</span> sshfs</span><br></pre></td></tr></table></figure>

<p>授予对某个设备的访问权限：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> -it <span class="attribute">--device</span>=/dev/ttyUSB0 debian bash</span><br></pre></td></tr></table></figure>

<p>授予对所有设备的访问权限：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --privileged -v <span class="regexp">/dev/</span>bus<span class="regexp">/usb:/</span>dev<span class="regexp">/bus/u</span>sb debian bash</span><br></pre></td></tr></table></figure>

<p>有关容器特权的更多信息请参阅 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9ydW4vIy9ydW50aW1lLXByaXZpbGVnZS1hbmQtbGludXgtY2FwYWJpbGl0aWVz">本文<i class="fa fa-external-link-alt"></i></span>。</p>
<h3 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/ps"><code>docker ps</code></a> 查看运行中的所有容器。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/logs"><code>docker logs</code></a> 从容器中读取日志。（你也可以使用自定义日志驱动，不过在 1.10 中，它只支持 <code>json-file</code> 和 <code>journald</code>）。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/inspect"><code>docker inspect</code></a> 查看某个容器的所有信息（包括 IP 地址）。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/events"><code>docker events</code></a> 从容器中获取事件 (events)。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/port"><code>docker port</code></a> 查看容器的公开端口。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/top"><code>docker top</code></a> 查看容器中活动进程。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/stats"><code>docker stats</code></a> 查看容器的资源使用量统计信息。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/diff"><code>docker diff</code></a> 查看容器文件系统中存在改动的文件。</li>
</ul>
<p><code>docker ps -a</code> 将显示所有容器，包括运行中和已停止的。</p>
<p><code>docker stats --all</code> 同样将显示所有容器，默认仅显示运行中的容器。</p>
<h3 id="导入-导出"><a href="#导入-导出" class="headerlink" title="导入 / 导出"></a>导入 / 导出</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/cp"><code>docker cp</code></a> 在容器和本地文件系统之间复制文件或目录。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/export"><code>docker export</code></a> 将容器的文件系统打包为归档文件流 (tarball archive stream) 并输出至标准输出 (STDOUT)。</li>
</ul>
<h3 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/exec"><code>docker exec</code></a> 在容器内执行命令。</li>
</ul>
<p>例如，进入正在运行的 <code>foo</code> 容器，并连接 (attach) 到一个新的 Shell 进程：<code>docker exec -it foo /bin/bash</code>。</p>
<h2 id="镜像-Images"><a href="#镜像-Images" class="headerlink" title="镜像(Images)"></a>镜像(Images)</h2><p>镜像是 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3VuZGVyc3RhbmRpbmctZG9ja2VyLyNob3ctZG9lcy1hLWRvY2tlci1pbWFnZS13b3Jr">Docker 容器的模板<i class="fa fa-external-link-alt"></i></span>。</p>
<h3 id="生命周期-1"><a href="#生命周期-1" class="headerlink" title="生命周期"></a>生命周期</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/images"><code>docker images</code></a> 查看所有镜像。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/import"><code>docker import</code></a> 从归档文件创建镜像。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/build"><code>docker build</code></a> 从 Dockerfile 创建镜像。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/commit"><code>docker commit</code></a> 为容器创建镜像，如果容器正在运行则会临时暂停。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/rmi"><code>docker rmi</code></a> 删除镜像。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/load"><code>docker load</code></a> 从标准输入 (STDIN) 加载归档包 (tar archive) 作为镜像，包括镜像本身和标签 (tags, 0.7 起)。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/save"><code>docker save</code></a> 将镜像打包为归档包，并输出至标准输出 (STDOUT)，包括所有的父层、标签和版本 (parent layers, tags, versions, 0.7 起)。</li>
</ul>
<h3 id="其它信息"><a href="#其它信息" class="headerlink" title="其它信息"></a>其它信息</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/history"><code>docker history</code></a> 查看镜像的历史记录。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/tag"><code>docker tag</code></a> 给镜像打标签命名（本地或者仓库均可）。</li>
</ul>
<h3 id="清理"><a href="#清理" class="headerlink" title="清理"></a>清理</h3><p>虽然你可以用 <code>docker rmi</code> 命令来删除指定的镜像，不过有个名为 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Nwb3RpZnkvZG9ja2VyLWdj">docker-gc<i class="fa fa-external-link-alt"></i></span> 的工具，它可以以一种安全的方式，清理掉那些不再被任何容器使用的镜像。Docker 1.13 起，使用 <code>docker image prune</code> 亦可删除未使用的镜像。参见 <a href="#%E6%B8%85%E7%90%86">清理</a>。</p>
<h3 id="加载-保存镜像"><a href="#加载-保存镜像" class="headerlink" title="加载 / 保存镜像"></a>加载 / 保存镜像</h3><p>从文件中加载镜像：</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">load</span> &lt; my_image.tar.gz</span><br></pre></td></tr></table></figure>

<p>保存既有镜像：</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save my_image:my_tag <span class="string">| gzip &gt; my_image.tar.gz</span></span><br></pre></td></tr></table></figure>

<h3 id="导入-导出容器"><a href="#导入-导出容器" class="headerlink" title="导入 / 导出容器"></a>导入 / 导出容器</h3><p>从文件中导入容器镜像：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">cat</span> my_container.tar.gz | docker <span class="keyword">import</span> - my_image:my_tag</span><br></pre></td></tr></table></figure>

<p>导出既有容器：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">docker</span> ex<span class="keyword">port</span> my_container | gzip &gt; my_container.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="加载已保存的镜像-与-导入已导出为镜像的容器-的不同"><a href="#加载已保存的镜像-与-导入已导出为镜像的容器-的不同" class="headerlink" title="加载已保存的镜像 与 导入已导出为镜像的容器 的不同"></a>加载已保存的镜像 与 导入已导出为镜像的容器 的不同</h3><p>通过 <code>load</code> 命令来加载镜像，会创建一个新的镜像，并继承原镜像的所有历史。<br>通过 <code>import</code> 将容器作为镜像导入，也会创建一个新的镜像，但并不包含原镜像的历史，因此会比使用 <code>load</code> 方式生成的镜像更小。</p>
<h2 id="网络-Networks"><a href="#网络-Networks" class="headerlink" title="网络(Networks)"></a>网络(Networks)</h2><p>Docker 具备 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3VzZXJndWlkZS9uZXR3b3JraW5nLw==">网络<i class="fa fa-external-link-alt"></i></span> 功能。我并不是很了解它，所以这是一个扩展本文的好地方。文档 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3VzZXJndWlkZS9uZXR3b3JraW5nL3dvcmstd2l0aC1uZXR3b3Jrcy8=">使用网络<i class="fa fa-external-link-alt"></i></span> 指出，这是一种无需暴露端口即可实现 Docker 容器间通信的好方法。</p>
<h3 id="生命周期-2"><a href="#生命周期-2" class="headerlink" title="生命周期"></a>生命周期</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/network_create/"><code>docker network create</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/network_rm/"><code>docker network rm</code></a></li>
</ul>
<h3 id="其它信息-1"><a href="#其它信息-1" class="headerlink" title="其它信息"></a>其它信息</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/network_ls/"><code>docker network ls</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/network_inspect/"><code>docker network inspect</code></a></li>
</ul>
<h3 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/network_connect/"><code>docker network connect</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/network_disconnect/"><code>docker network disconnect</code></a></li>
</ul>
<p>你可以 <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmplc3NmcmF6LmNvbS9wb3N0L2lwcy1mb3ItYWxsLXRoZS10aGluZ3Mv">为容器指定 IP 地址<i class="fa fa-external-link-alt"></i></span>：</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用你自己的子网和网关创建一个桥接网络</span></span><br><span class="line"><span class="string">docker</span> <span class="string">network</span> <span class="string">create</span> <span class="built_in">--subnet</span> <span class="string">203</span>.<span class="string">0</span>.<span class="string">113</span>.<span class="string">0</span>/<span class="string">24</span> <span class="built_in">--gateway</span> <span class="string">203</span>.<span class="string">0</span>.<span class="string">113</span>.<span class="string">254</span> <span class="string">iptastic</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span><span class="comment"># 基于以上创建的网络，运行一个 Nginx 容器并指定 IP</span></span><br><span class="line">$ <span class="string">docker</span> <span class="string">run</span> <span class="built_in">--rm</span> -<span class="string">it</span> <span class="built_in">--net</span> <span class="string">iptastic</span> <span class="built_in">--ip</span> <span class="string">203</span>.<span class="string">0</span>.<span class="string">113</span>.<span class="string">2</span> <span class="string">nginx</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span><span class="comment"># 在其他地方使用 CURL 访问这个 IP（假设该 IP 为公网）</span></span><br><span class="line">$ <span class="string">curl</span> <span class="string">203</span>.<span class="string">0</span>.<span class="string">113</span>.<span class="string">2</span></span><br></pre></td></tr></table></figure>

<h2 id="仓管中心和仓库-Registry-amp-Repository"><a href="#仓管中心和仓库-Registry-amp-Repository" class="headerlink" title="仓管中心和仓库(Registry &amp; Repository)"></a>仓管中心和仓库(Registry &amp; Repository)</h2><p>仓库 (repository) 是 <em>被托管(hosted)</em> 的已命名镜像 (tagged images) 的集合，这组镜像用于构建容器文件系统。</p>
<p>仓管中心 (registry) 则是 <em>托管服务(host)</em> – 用于存储仓库并提供 HTTP API，以便 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3R1dG9yaWFscy9kb2NrZXJyZXBvcy8=">管理仓库的上传和下载<i class="fa fa-external-link-alt"></i></span>。</p>
<p>Docker 官方托管着自己的 <span class="exturl" data-url="aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS8=">仓管中心<i class="fa fa-external-link-alt"></i></span>，包含着数量众多的仓库。不过话虽如此，这个仓管中心 <span class="exturl" data-url="aHR0cHM6Ly90aXRhbm91cy5jb20vcG9zdHMvZG9ja2VyLWluc2VjdXJpdHk=">并没有很好地验证镜像<i class="fa fa-external-link-alt"></i></span>，所以如果你担心安全问题的话，请尽量避免使用它。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/login"><code>docker login</code></a> 登入仓管中心。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/logout"><code>docker logout</code></a> 登出仓管中心。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/search"><code>docker search</code></a> 从仓管中心检索镜像。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/pull"><code>docker pull</code></a> 从仓管中心拉取镜像到本地。</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/push"><code>docker push</code></a> 从本地推送镜像到仓管中心。</li>
</ul>
<h3 id="本地仓管中心"><a href="#本地仓管中心" class="headerlink" title="本地仓管中心"></a>本地仓管中心</h3><p>你可以使用 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvY2tlci9kaXN0cmlidXRpb24=">docker distribution<i class="fa fa-external-link-alt"></i></span> 项目搭建本地的仓管中心，详情参阅 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvY2tlci9kb2NrZXIuZ2l0aHViLmlvL2Jsb2IvbWFzdGVyL3JlZ2lzdHJ5L2RlcGxveWluZy5tZA==">本地发布 (local deploy)<i class="fa fa-external-link-alt"></i></span> 的介绍。</p>
<p>科学上网后，也可以看看 <span class="exturl" data-url="aHR0cHM6Ly9ncm91cHMuZ29vZ2xlLmNvbS9hL2RvY2tlcnByb2plY3Qub3JnL2ZvcnVtLyMhZm9ydW0vZGlzdHJpYnV0aW9u">Google+ Group<i class="fa fa-external-link-alt"></i></span>。</p>
<h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><p>当你执行 <code>docker build</code> 时，Docker 将会根据 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLw==">配置文件<i class="fa fa-external-link-alt"></i></span> 启动 Docker 容器。远优于使用 <code>docker commit</code>。</p>
<p>以下是一些编写 Dockerfile 的常用编辑器，并链接到适配的语法高亮模块︰</p>
<ul>
<li>如果你在使用 <span class="exturl" data-url="aHR0cDovL2plZGl0Lm9yZy8=">jEdit<i class="fa fa-external-link-alt"></i></span>，你可以使用我开发的 Dockerfile <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dzYXJnZW50L2plZGl0LWRvY2tlci1tb2Rl">语法高亮模块<i class="fa fa-external-link-alt"></i></span>。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9wYWNrYWdlY29udHJvbC5pby9wYWNrYWdlcy9Eb2NrZXJmaWxlJTIwU3ludGF4JTIwSGlnaGxpZ2h0aW5n">Sublime Text 2<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9hdG9tLmlvL3BhY2thZ2VzL2xhbmd1YWdlLWRvY2tlcg==">Atom<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VrYWxpbmluL0RvY2tlcmZpbGUudmlt">Vim<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Nwb3RpZnkvZG9ja2VyZmlsZS1tb2Rl">Emacs<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvY2tlci9kb2NrZXIvdHJlZS9tYXN0ZXIvY29udHJpYi9zeW50YXgvdGV4dG1hdGU=">TextMate<i class="fa fa-external-link-alt"></i></span></li>
<li>更多信息请参阅 <span class="exturl" data-url="aHR0cHM6Ly9kb21laWRlLmdpdGh1Yi5pby8=">Docker 遇上 IDE<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h3 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNkb2NrZXJpZ25vcmUtZmlsZQ==">.dockerignore<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNmcm9t">FROM<i class="fa fa-external-link-alt"></i></span> 为其他指令设置基础镜像 (Base Image)。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNtYWludGFpbmVyLWRlcHJlY2F0ZWQ=">MAINTAINER (deprecated - use LABEL instead)<i class="fa fa-external-link-alt"></i></span> 为生成的镜像设置作者字段。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNydW4=">RUN<i class="fa fa-external-link-alt"></i></span> 在当前镜像的基础上生成一个新层并执行命令。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNjbWQ=">CMD<i class="fa fa-external-link-alt"></i></span> 设置容器默认执行命令。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNleHBvc2U=">EXPOSE<i class="fa fa-external-link-alt"></i></span> 告知 Docker 容器在运行时所要监听的网络端口。注意：并没有实际上将端口设置为可访问。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNlbnY=">ENV<i class="fa fa-external-link-alt"></i></span> 设置环境变量。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNhZGQ=">ADD<i class="fa fa-external-link-alt"></i></span> 将文件、目录或远程文件复制到容器中。缓存无效。请尽量用 <code>COPY</code> 代替 <code>ADD</code>。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNjb3B5">COPY<i class="fa fa-external-link-alt"></i></span> 将文件或文件夹复制到容器中。注意：将使用 ROOT 用户复制文件，故无论 USER / WORKDIR 指令如何配置，你都需要手动修改其所有者（<code>chown</code>），<code>ADD</code> 也是一样。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNlbnRyeXBvaW50">ENTRYPOINT<i class="fa fa-external-link-alt"></i></span> 将容器设为可执行的。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyN2b2x1bWU=">VOLUME<i class="fa fa-external-link-alt"></i></span> 在容器内部创建挂载点 (mount point) 指向外部挂载的卷标或其他容器。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyN1c2Vy">USER<i class="fa fa-external-link-alt"></i></span> 设置随后执行 RUN / CMD / ENTRYPOINT 命令的用户名。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyN3b3JrZGly">WORKDIR<i class="fa fa-external-link-alt"></i></span> 设置工作目录 (working directory)。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNhcmc=">ARG<i class="fa fa-external-link-alt"></i></span> 定义编译时 (build-time) 变量。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNvbmJ1aWxk">ONBUILD<i class="fa fa-external-link-alt"></i></span> 添加触发指令，当该镜像被作为其他镜像的基础镜像时该指令会被触发。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNzdG9wc2lnbmFs">STOPSIGNAL<i class="fa fa-external-link-alt"></i></span> 设置停止容器时，向容器内发送的系统调用信号 (system call signal)。</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vY29uZmlnL2xhYmVscy1jdXN0b20tbWV0YWRhdGEv">LABEL<i class="fa fa-external-link-alt"></i></span> 将键值对元数据 (key/value metadata) 应用到镜像、容器或是守护进程。</li>
</ul>
<h3 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h3><ul>
<li><span class="exturl" data-url="aHR0cDovL2ZsdXg3LmNvbS9ibG9ncy9kb2NrZXIvZG9ja2VyLXR1dG9yaWFsLXNlcmllcy1wYXJ0LTMtYXV0b21hdGlvbi1pcy10aGUtd29yZC11c2luZy1kb2NrZXJmaWxlLw==">Flux7’s Dockerfile Tutorial<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNkb2NrZXJmaWxlLWV4YW1wbGVz">Examples<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3VzZXJndWlkZS9lbmctaW1hZ2UvZG9ja2VyZmlsZV9iZXN0LXByYWN0aWNlcy8=">Best practices for writing Dockerfiles<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cDovL2Nyb3NieW1pY2hhZWwuY29tLw==">Michael Crosby<i class="fa fa-external-link-alt"></i></span> 还有更多的 <span class="exturl" data-url="aHR0cDovL2Nyb3NieW1pY2hhZWwuY29tL2RvY2tlcmZpbGUtYmVzdC1wcmFjdGljZXMuaHRtbA==">Dockerfiles best practices<i class="fa fa-external-link-alt"></i></span> / <span class="exturl" data-url="aHR0cDovL2Nyb3NieW1pY2hhZWwuY29tL2RvY2tlcmZpbGUtYmVzdC1wcmFjdGljZXMtdGFrZS0yLmh0bWw=">take 2<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cDovL2pvbmF0aGFuLmJlcmdrbm9mZi5jb20vam91cm5hbC9idWlsZGluZy1nb29kLWRvY2tlci1pbWFnZXM=">Building Good Docker Images<i class="fa fa-external-link-alt"></i></span> / <span class="exturl" data-url="aHR0cDovL2pvbmF0aGFuLmJlcmdrbm9mZi5jb20vam91cm5hbC9idWlsZGluZy1iZXR0ZXItZG9ja2VyLWltYWdlcw==">Building Better Docker Images<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9zcGVha2VyZGVjay5jb20vZ2FyZXRoci9tYW5hZ2luZy1jb250YWluZXItY29uZmlndXJhdGlvbi13aXRoLW1ldGFkYXRh">Managing Container Configuration with Metadata<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h2 id="层-Layers"><a href="#层-Layers" class="headerlink" title="层(Layers)"></a>层(Layers)</h2><p>Docker 的版本化文件系统是基于层的。就像 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3VzZXJndWlkZS9zdG9yYWdlZHJpdmVyL2ltYWdlc2FuZGNvbnRhaW5lcnMv">Git 的提交或文件变更系统<i class="fa fa-external-link-alt"></i></span> 一样。</p>
<h2 id="链接-Links"><a href="#链接-Links" class="headerlink" title="链接(Links)"></a>链接(Links)</h2><p>链接 (links) <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vdXNlcmd1aWRlL2RvY2tlcmxpbmtzLw==">通过 TCP/IP 端口<i class="fa fa-external-link-alt"></i></span> 实现 Docker 容器之间的通讯。<span class="exturl" data-url="aHR0cHM6Ly9ibG9ncy5hdGxhc3NpYW4uY29tLzIwMTMvMTEvZG9ja2VyLWFsbC10aGUtdGhpbmdzLWF0LWF0bGFzc2lhbi1hdXRvbWF0aW9uLWFuZC13aXJpbmcv">Atlassian<i class="fa fa-external-link-alt"></i></span> 展示了可用的例子。你还可以 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3VzZXJndWlkZS9uZXR3b3JraW5nL2RlZmF1bHRfbmV0d29yay9kb2NrZXJsaW5rcy8jL3VwZGF0aW5nLXRoZS1ldGNob3N0cy1maWxl">通过主机名 (hostname) 链接<i class="fa fa-external-link-alt"></i></span>。</p>
<p>在某种意义上来说，该特性已经被 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vbmV0d29yay8=">自定义网络<i class="fa fa-external-link-alt"></i></span> 所替代。</p>
<p>注意: 如果你希望容器之间<strong>只</strong>通过链接进行通讯，在启动 Docker 守护进程时，请使用 <code>-icc=false</code> 来禁用内部进程通讯。</p>
<p>假设你有一个名为 CONTAINER 的容器（通过 <code>docker run --name CONTAINER</code> 指定）并且在 Dockerfile 中，暴露了一个端口:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">EXPOSE</span> <span class="number">1337</span></span><br></pre></td></tr></table></figure>

<p>然后，我们创建另外一个名为 LINKED 的容器:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> -d <span class="comment">--link CONTAINER:ALIAS --name LINKED user/wordpress</span></span><br></pre></td></tr></table></figure>

<p>然后 CONTAINER 暴露的端口和别名将会以如下的环境变量出现在 LINKED 中:</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$ALIAS</span>_PORT_1337_TCP_PORT</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$ALIAS</span>_PORT_1337_TCP_ADDR</span></span><br></pre></td></tr></table></figure>

<p>那么你便可以通过这种方式来连接它了。</p>
<p>使用 <code>docker rm --link</code> 即可删除链接。</p>
<p>通常，Docker 容器（亦可理解为「服务」）之间的链接，是「服务发现」的一个子集。如果你打算在生产中大规模使用 Docker，这将是一个很大的问题。请参阅<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGlnaXRhbG9jZWFuLmNvbS9jb21tdW5pdHkvdHV0b3JpYWxzL3RoZS1kb2NrZXItZWNvc3lzdGVtLXNlcnZpY2UtZGlzY292ZXJ5LWFuZC1kaXN0cmlidXRlZC1jb25maWd1cmF0aW9uLXN0b3Jlcw==">The Docker Ecosystem: Service Discovery and Distributed Configuration Stores<i class="fa fa-external-link-alt"></i></span> 获取更多信息。</p>
<h2 id="卷标-Volumes"><a href="#卷标-Volumes" class="headerlink" title="卷标(Volumes)"></a>卷标(Volumes)</h2><p>Docker 的卷标 (volumes) 是 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3R1dG9yaWFscy9kb2NrZXJ2b2x1bWVzLw==">独立的文件系统<i class="fa fa-external-link-alt"></i></span>。它们并非必须连接到特定的容器上。</p>
<h3 id="生命周期-3"><a href="#生命周期-3" class="headerlink" title="生命周期"></a>生命周期</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/volume_create/"><code>docker volume create</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/volume_rm/"><code>docker volume rm</code></a></li>
</ul>
<h3 id="信息-1"><a href="#信息-1" class="headerlink" title="信息"></a>信息</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/volume_ls/"><code>docker volume ls</code></a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/volume_inspect/"><code>docker volume inspect</code></a></li>
</ul>
<p>卷标在不能使用链接（只有 TCP/IP）的情况下非常有用。例如，如果你有两个 Docker 实例需要通讯并在文件系统上留下记录。</p>
<p>你可以一次性将其挂载到多个 docker 容器上，通过 <code>docker run --volumes-from</code>。</p>
<p>因为卷标是独立的文件系统，它们通常被用于存储各容器之间的瞬时状态。也就是说，你可以配置一个无状态临时容器，关掉之后，当你有第二个这种临时容器实例的时候，你可以从上一次保存的状态继续执行。</p>
<p>查看 <span class="exturl" data-url="aHR0cDovL2Nyb3NieW1pY2hhZWwuY29tL2FkdmFuY2VkLWRvY2tlci12b2x1bWVzLmh0bWw=">卷标进阶<i class="fa fa-external-link-alt"></i></span> 来获取更多细节。<span class="exturl" data-url="aHR0cDovL2NvbnRhaW5lcjQyLmNvbS8yMDE0LzExLzAzL2RvY2tlci1pbmRlcHRoLXZvbHVtZXMv">Container42<i class="fa fa-external-link-alt"></i></span> 非常有用。</p>
<p>你可以 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3R1dG9yaWFscy9kb2NrZXJ2b2x1bWVzLyNtb3VudC1hLWhvc3QtZGlyZWN0b3J5LWFzLWEtZGF0YS12b2x1bWU=">将宿主 MacOS 的文件夹映射为 Docker 卷标<i class="fa fa-external-link-alt"></i></span>：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v <span class="regexp">/Users/</span>wsargent<span class="regexp">/myapp/</span>src:/src</span><br></pre></td></tr></table></figure>

<p>你也可以用远程 NFS 卷标，如果你觉得你 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3R1dG9yaWFscy9kb2NrZXJ2b2x1bWVzLyMvbW91bnQtYS1zaGFyZWQtc3RvcmFnZS12b2x1bWUtYXMtYS1kYXRhLXZvbHVtZQ==">有足够勇气<i class="fa fa-external-link-alt"></i></span>。</p>
<p>还可以考虑运行一个纯数据容器，像 <span class="exturl" data-url="aHR0cDovL2NvbnRhaW5lcjQyLmNvbS8yMDEzLzEyLzE2L3BlcnNpc3RlbnQtdm9sdW1lcy13aXRoLWRvY2tlci1jb250YWluZXItYXMtdm9sdW1lLXBhdHRlcm4v">这里<i class="fa fa-external-link-alt"></i></span> 所说的那样，提供可移植数据。</p>
<p>记得，<a href="#%E5%B0%86%E6%96%87%E4%BB%B6%E6%8C%82%E8%BD%BD%E4%B8%BA%E5%8D%B7%E6%A0%87">文件也可以被挂载为卷标</a>。</p>
<h2 id="暴露端口-Exposing-ports"><a href="#暴露端口-Exposing-ports" class="headerlink" title="暴露端口(Exposing ports)"></a>暴露端口(Exposing ports)</h2><p>通过宿主容器暴露输入端口相当 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9ydW4vI2V4cG9zZS1pbmNvbWluZy1wb3J0cw==">繁琐但有效的<i class="fa fa-external-link-alt"></i></span>。</p>
<p>例如使用 <code>-p</code> 将容器端口映射到宿主端口上（只使用本地主机 (localhost) 接口）：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> -p 127.0.0.1:<span class="variable">$HOSTPORT</span>:<span class="variable">$CONTAINERPORT</span> --name CONTAINER -t someimage</span><br></pre></td></tr></table></figure>

<p>你可以使用 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNleHBvc2U=">EXPOSE<i class="fa fa-external-link-alt"></i></span> 告知 Docker，该容器在运行时监听指定的端口：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPOSE <span class="tag">&lt;<span class="name">CONTAINERPORT</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>但是注意 EXPOSE 并不会直接暴露端口，你需要用参数 <code>-p</code> 。比如说你要在 localhost 上暴露容器的端口:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A DOCKER -<span class="keyword">p</span> tcp --dport <span class="symbol">&lt;LOCALHOSTPORT&gt;</span> -<span class="keyword">j</span> DNAT --<span class="keyword">to</span>-destination <span class="symbol">&lt;CONTAINERIP&gt;</span>:<span class="symbol">&lt;PORT&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果你是在 Virtualbox 中运行 Docker，那么你需要配置端口转发 (forward the port)。使用 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnZhZ3JhbnR1cC5jb20vdjIvbmV0d29ya2luZy9mb3J3YXJkZWRfcG9ydHMuaHRtbA==">forwarded_port<i class="fa fa-external-link-alt"></i></span> 在 Vagrantfile 上配置暴露的端口范围，这样你就可以动态地映射了：</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Vagrant.configure(VAGRANTFILE_API_VERSION) <span class="built_in">do</span> |<span class="type">config</span>|<span class="type"></span></span><br><span class="line"><span class="type">  ...</span></span><br><span class="line"><span class="type"></span></span><br><span class="line"><span class="type">  (49000</span>.<span class="number">.49900</span>).each <span class="built_in">do</span> |<span class="type">port</span>|<span class="type"></span></span><br><span class="line"><span class="type">    config</span>.vm.network :forwarded_port, :host =&gt; port, :guest =&gt; port</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>如果你忘记了将什么端口映射到宿主机上的话，可使用 <code>docker port</code> 查看：</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">port</span> CONTAINER <span class="variable">$CONTAINERPORT</span></span><br></pre></td></tr></table></figure>

<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><p>这里有一些最佳实践，以及争论焦点：</p>
<ul>
<li><span class="exturl" data-url="aHR0cDovL2dyZWdvcnlzem9yYy5jb20vYmxvZy8yMDE0LzEwLzE2L3RoZS1yYWJiaXQtaG9sZS1vZi11c2luZy1kb2NrZXItaW4tYXV0b21hdGVkLXRlc3RzLw==">The Rabbit Hole of Using Docker in Automated Tests<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9icmlkZ2V0a3JvbWhvdXQ=">Bridget Kromhout<i class="fa fa-external-link-alt"></i></span> has a useful blog post on <span class="exturl" data-url="aHR0cDovL3N5c2FkdmVudC5ibG9nc3BvdC5jby51ay8yMDE0LzEyL2RheS0xLWRvY2tlci1pbi1wcm9kdWN0aW9uLXJlYWxpdHktbm90Lmh0bWw=">running Docker in production<i class="fa fa-external-link-alt"></i></span> at Dramafever.  </li>
<li>There’s also a best practices <span class="exturl" data-url="aHR0cDovL2RldmVsb3BlcnMubHlzdC5jb20vZGV2b3BzLzIwMTQvMTIvMDgvZG9ja2VyLw==">blog post<i class="fa fa-external-link-alt"></i></span> from Lyst.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9lbmdpbmVlcmluZy5zYWxlc2ZvcmNlaXEuY29tLzIwMTMvMTEvMDUvYS1kb2NrZXItZGV2LWVudmlyb25tZW50LWluLTI0LWhvdXJzLXBhcnQtMi1vZi0yLmh0bWw=">A Docker Dev Environment in 24 Hours!<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly90ZXJzZXN5c3RlbXMuY29tLzIwMTMvMTEvMjAvYnVpbGRpbmctYS1kZXZlbG9wbWVudC1lbnZpcm9ubWVudC13aXRoLWRvY2tlci8=">Building a Development Environment With Docker<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9zYW1zYWZmcm9uLmNvbS9hcmNoaXZlLzIwMTMvMTEvMDcvZGlzY291cnNlLWluLWEtZG9ja2VyLWNvbnRhaW5lcg==">Discourse in a Docker Container<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h2 id="安全-Security"><a href="#安全-Security" class="headerlink" title="安全(Security)"></a>安全(Security)</h2><p>这节准备讨论一些关于 Docker 安全性的问题。Docker 官方文档 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vYXJ0aWNsZXMvc2VjdXJpdHkv">安全<i class="fa fa-external-link-alt"></i></span> 页面讲述了更多细节。</p>
<p>首先第一件事：Docker 是有 root 权限的。如果你在 <code>docker</code> 组，那么你就有 <span class="exturl" data-url="aHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTYxMjI2MjExNzU1L2h0dHA6Ly9yZXZlbnRsb3YuY29tL2Fkdmlzb3JpZXMvdXNpbmctdGhlLWRvY2tlci1jb21tYW5kLXRvLXJvb3QtdGhlLWhvc3Q=">root 权限<i class="fa fa-external-link-alt"></i></span>。如果你将 Docker 的 Unix Socket 暴露给容器，意味着你赋予了容器 <span class="exturl" data-url="aHR0cHM6Ly93d3cubHZoLmlvL3Bvc3RzL2RvbnQtZXhwb3NlLXRoZS1kb2NrZXItc29ja2V0LW5vdC1ldmVuLXRvLWEtY29udGFpbmVyLw==">宿主机 root 权限<i class="fa fa-external-link-alt"></i></span>。</p>
<p>Docker 不应当作为唯一的防御措施。你应当使其更加安全可靠。</p>
<p>为了更好地理解容器暴露了什么，可参阅由 <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9keW5fX18=">Aaron Grattafiori<i class="fa fa-external-link-alt"></i></span> 编写的 <span class="exturl" data-url="aHR0cHM6Ly93d3cubmNjZ3JvdXAudHJ1c3QvZ2xvYmFsYXNzZXRzL291ci1yZXNlYXJjaC91cy93aGl0ZXBhcGVycy8yMDE2L2FwcmlsL25jY19ncm91cF91bmRlcnN0YW5kaW5nX2hhcmRlbmluZ19saW51eF9jb250YWluZXJzLTEtMS5wZGY=">Understanding and Hardening Linux Containers<i class="fa fa-external-link-alt"></i></span>。这是一个完整全面且包含大量链接和脚注的容器问题指南，介绍了许多有用的内容。即使你已经加固过容器，以下的安全提示依然十分有帮助，但并不能代替理解的过程。</p>
<h3 id="安全提示"><a href="#安全提示" class="headerlink" title="安全提示"></a>安全提示</h3><p>为了最大的安全性，你应当考虑在虚拟机上运行 Docker。这是直接从 Docker 安全团队拿来的资料 – <span class="exturl" data-url="aHR0cDovL3d3dy5zbGlkZXNoYXJlLm5ldC9qcGV0YXp6by9saW51eC1jb250YWluZXJzLWx4Yy1kb2NrZXItYW5kLXNlY3VyaXR5">slides<i class="fa fa-external-link-alt"></i></span> / <span class="exturl" data-url="aHR0cDovL3d3dy5wcm9qZWN0YXRvbWljLmlvL2Jsb2cvMjAxNC8wOC9pcy1pdC1zYWZlLWEtbG9vay1hdC1kb2NrZXItYW5kLXNlY3VyaXR5LWZyb20tbGludXhjb24v">notes<i class="fa fa-external-link-alt"></i></span>。之后，可使用 AppArmor、seccomp、SELinux、grsec 等来 <span class="exturl" data-url="aHR0cDovL2xpbnV4LWF1ZGl0LmNvbS9kb2NrZXItc2VjdXJpdHktYmVzdC1wcmFjdGljZXMtZm9yLXlvdXItdmVzc2VsLWFuZC1jb250YWluZXJzLw==">限制容器的权限<i class="fa fa-external-link-alt"></i></span>。更多细节，请查阅 <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmRvY2tlci5jb20vMjAxNi8wMi9kb2NrZXItZW5naW5lLTEtMTAtc2VjdXJpdHkv">Docker 1.10 security features<i class="fa fa-external-link-alt"></i></span>。</p>
<p>Docker 镜像 ID 属于 <span class="exturl" data-url="aHR0cHM6Ly9tZWRpdW0uY29tL0BxdWF5aW8veW91ci1kb2NrZXItaW1hZ2UtaWRzLWFyZS1zZWNyZXRzLWFuZC1pdHMtdGltZS15b3UtdHJlYXRlZC10aGVtLXRoYXQtd2F5LWY1NWU5ZjE0YzFhNA==">敏感信息<i class="fa fa-external-link-alt"></i></span> 所以它不应该向外界公开。请将它们当作密码来对待。</p>
<p>阅读由 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2tvbnN0cnVrdG9pZA==">Thomas Sjögren<i class="fa fa-external-link-alt"></i></span> 编写的 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2tvbnN0cnVrdG9pZC9Eb2NrZXIvYmxvYi9tYXN0ZXIvU2VjdXJpdHkvQ2hlYXRTaGVldC5hZG9j">Docker Security Cheat Sheet<i class="fa fa-external-link-alt"></i></span>：关于加固容器的不错的建议。</p>
<p>查看 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvY2tlci9kb2NrZXItYmVuY2gtc2VjdXJpdHk=">Docker 安全测试脚本<i class="fa fa-external-link-alt"></i></span>，下载 <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmRvY2tlci5jb20vMjAxNS8wNS91bmRlcnN0YW5kaW5nLWRvY2tlci1zZWN1cml0eS1hbmQtYmVzdC1wcmFjdGljZXMv">最佳实践白皮书<i class="fa fa-external-link-alt"></i></span>。</p>
<p>你应当远离使用非稳定版本 grsecurity / pax 的内核，比如 <span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQWxwaW5lX0xpbnV4">Alpine Linux<i class="fa fa-external-link-alt"></i></span>。如果在产品中用了 grsecurity，那么你应该考虑使用有 <span class="exturl" data-url="aHR0cHM6Ly9ncnNlY3VyaXR5Lm5ldC9idXNpbmVzc19zdXBwb3J0LnBocA==">商业支持<i class="fa fa-external-link-alt"></i></span> 的 <span class="exturl" data-url="aHR0cHM6Ly9ncnNlY3VyaXR5Lm5ldC9hbm5vdW5jZS5waHA=">稳定版本<i class="fa fa-external-link-alt"></i></span>，就像你对待 RedHat 那样。虽然要 $200 每月，但对于你的运维预算来说不值一提。</p>
<p>从 Docker 1.11 开始，你可以轻松的限制在容器中可用的进程数，以防止 fork 炸弹。 这要求 Linux 内核 &gt;= 4.3，并且要在内核配置中打开 CGROUP_PIDS=y。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> <span class="attribute">--pids-limit</span>=64</span><br></pre></td></tr></table></figure>

<p>同时，你也可以限制进程再获取新权限。该功能是 Linux 内核从 3.5 版本开始就拥有的。你可以从 <span class="exturl" data-url="aHR0cDovL3d3dy5wcm9qZWN0YXRvbWljLmlvL2Jsb2cvMjAxNi8wMy9uby1uZXctcHJpdnMtZG9ja2VyLw==">这篇博客<i class="fa fa-external-link-alt"></i></span> 中阅读到更多关于这方面的内容。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> <span class="attribute">--security-opt</span>=<span class="literal">no</span>-new-privileges</span><br></pre></td></tr></table></figure>

<p>以下内容摘选自 <span class="exturl" data-url="aHR0cDovL2NvbnRhaW5lci1zb2x1dGlvbnMuY29tL2lzLWRvY2tlci1zYWZlLWZvci1wcm9kdWN0aW9uLw==">Container Solutions<i class="fa fa-external-link-alt"></i></span> 的 <span class="exturl" data-url="aHR0cDovL2NvbnRhaW5lci1zb2x1dGlvbnMuY29tL2NvbnRlbnQvdXBsb2Fkcy8yMDE1LzA2LzE1LjA2LjE1X0RvY2tlckNoZWF0U2hlZXRfQTIucGRm">Docker Security Cheat Sheet<i class="fa fa-external-link-alt"></i></span>（PDF 版本，难以使用，故复制至此）：</p>
<p>关闭内部进程通讯：</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">docker</span> <span class="literal">-</span><span class="comment">d</span> --<span class="comment">icc=false</span> --<span class="comment">iptables</span></span><br></pre></td></tr></table></figure>

<p>设置容器为只读：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> <span class="comment">--read-only</span></span><br></pre></td></tr></table></figure>

<p>通过 hashsum 来验证卷标：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> pull debian@sha<span class="number">256</span>:a<span class="number">25306</span>f<span class="number">3850</span>e<span class="number">1</span>bd<span class="number">44541976</span>aa<span class="number">7</span>b<span class="number">5</span>fd<span class="number">0</span>a<span class="number">29</span>be</span><br></pre></td></tr></table></figure>

<p>设置卷标为只读：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v $(<span class="keyword">pwd</span>)/secret<span class="variable">s:</span>/secret<span class="variable">s:ro</span> debian</span><br></pre></td></tr></table></figure>

<p>在 Dockerfile 中定义用户并以该用户运行，避免在容器中以 ROOT 身份操作：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUN groupadd -r <span class="keyword">user</span> <span class="title">&amp;&amp; useradd</span> -r -g <span class="keyword">user</span> <span class="title">user</span></span><br><span class="line"><span class="keyword">USER</span> <span class="title">user</span></span><br></pre></td></tr></table></figure>

<h3 id="用户命名空间-User-Namespaces"><a href="#用户命名空间-User-Namespaces" class="headerlink" title="用户命名空间(User Namespaces)"></a>用户命名空间(User Namespaces)</h3><p>还可以通过使用 <span class="exturl" data-url="aHR0cHM6Ly9zM2hoLndvcmRwcmVzcy5jb20vMjAxMy8wNy8xOS9jcmVhdGluZy1hbmQtdXNpbmctY29udGFpbmVycy13aXRob3V0LXByaXZpbGVnZS8=">用户命名空间<i class="fa fa-external-link-alt"></i></span> – 自 1.10 版本起已内置，但默认并未启用。</p>
<p>要在 Ubuntu 15.10 中启用用户命名空间 (remap the userns)，请 <span class="exturl" data-url="aHR0cHM6Ly9yYWVzZW5lLmdpdGh1Yi5pby9ibG9nLzIwMTYvMDIvMDQvRG9ja2VyLVVzZXItTmFtZXNwYWNlcy8=">跟着这篇博客的例子<i class="fa fa-external-link-alt"></i></span> 来做。</p>
<h3 id="安全相关视频"><a href="#安全相关视频" class="headerlink" title="安全相关视频"></a>安全相关视频</h3><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly95b3V0dS5iZS8wNExPdU1nTmo5VQ==">Using Docker Safely<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly95b3V0dS5iZS9LbXhPWG1QaFpiaw==">Securing your applications using Docker<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly95b3V0dS5iZS9hOWxFOVVycjZBUQ==">Container security: Do containers actually contain?<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1pTjZRYnN6QjFSOA==">Linux Containers: Future or Fantasy?<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h3 id="安全路线图"><a href="#安全路线图" class="headerlink" title="安全路线图"></a>安全路线图</h3><p>Docker 的路线图提到关于 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvY2tlci9kb2NrZXIvYmxvYi9tYXN0ZXIvUk9BRE1BUC5tZCMxMS1zZWN1cml0eQ==">seccomp 的支持<i class="fa fa-external-link-alt"></i></span>。<br>一个名为 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2pmcmF6ZWxsZS9iYW5l">bane<i class="fa fa-external-link-alt"></i></span> 的 AppArmor 策略生成器正在实现 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvY2tlci9kb2NrZXIvaXNzdWVzLzE3MTQy">安全配置文件<i class="fa fa-external-link-alt"></i></span>。</p>
<h2 id="小贴士"><a href="#小贴士" class="headerlink" title="小贴士"></a>小贴士</h2><p>链接：</p>
<ul>
<li><span class="exturl" data-url="aHR0cDovL3Nzc3NsaWRlLmNvbS9zcGVha2VyZGVjay5jb20vYm1vcmVhcnR5LzE1LWRvY2tlci10aXBzLWluLTUtbWludXRlcw==">15 Docker Tips in 5 minutes<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9jb2RlZnJlc2guaW8vYmxvZy9ldmVyeWRheS1oYWNrcy1kb2NrZXIv">CodeFresh Everyday Hacks Docker<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h3 id="清理-1"><a href="#清理-1" class="headerlink" title="清理"></a>清理</h3><p>最新的 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvY2tlci9kb2NrZXIvcHVsbC8yNjEwOA==">数据管理命令<i class="fa fa-external-link-alt"></i></span> 已在 Docker 1.13 实现：</p>
<ul>
<li><code>docker system prune</code></li>
<li><code>docker volume prune</code></li>
<li><code>docker network prune</code></li>
<li><code>docker container prune</code></li>
<li><code>docker image prune</code></li>
</ul>
<h3 id="df-命令"><a href="#df-命令" class="headerlink" title="df 命令"></a>df 命令</h3><p><code>docker system df</code> 将显示当前 Docker 各部分占用的磁盘空间。</p>
<h3 id="Heredoc-声明-Docker-容器"><a href="#Heredoc-声明-Docker-容器" class="headerlink" title="Heredoc 声明 Docker 容器"></a>Heredoc 声明 Docker 容器</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker build -t htop - &lt;&lt; EOF</span><br><span class="line"><span class="keyword">FROM</span> alpine</span><br><span class="line"><span class="builtin-name">RUN</span> apk --no-cache <span class="builtin-name">add</span> htop</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="最近一次的容器-ID"><a href="#最近一次的容器-ID" class="headerlink" title="最近一次的容器 ID"></a>最近一次的容器 ID</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alias <span class="attribute">dl</span>=<span class="string">&#x27;docker ps -l -q&#x27;</span></span><br><span class="line">docker <span class="builtin-name">run</span> ubuntu echo hello world</span><br><span class="line">docker commit $(dl) helloworld</span><br></pre></td></tr></table></figure>

<h3 id="带命令的提交（需要-Dockerfile）"><a href="#带命令的提交（需要-Dockerfile）" class="headerlink" title="带命令的提交（需要 Dockerfile）"></a>带命令的提交（需要 Dockerfile）</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -<span class="built_in">run</span>=&#x27;&#123;<span class="string">&quot;Cmd&quot;</span>:[<span class="string">&quot;postgres&quot;</span>, <span class="string">&quot;-too -many -opts&quot;</span>]&#125;&#x27; $(dl) postgres</span><br></pre></td></tr></table></figure>

<h3 id="获取-IP-地址"><a href="#获取-IP-地址" class="headerlink" title="获取 IP 地址"></a>获取 IP 地址</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">inspect</span> $(dl) | <span class="keyword">grep</span> -wm1 IPAddress | cut -d <span class="string">&#x27;&quot;&#x27;</span> -f <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>或使用 <span class="exturl" data-url="aHR0cHM6Ly9zdGVkb2xhbi5naXRodWIuaW8vanEv">jq<i class="fa fa-external-link-alt"></i></span>:</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect $(dl) | jq -r <span class="string">&#x27;.[0].NetworkSettings.IPAddress&#x27;</span></span><br></pre></td></tr></table></figure>

<p>或使用 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9jb21tYW5kbGluZS9pbnNwZWN0">go 模板<i class="fa fa-external-link-alt"></i></span>：</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">docker inspect -f &#x27;</span><span class="template-variable">&#123;&#123; <span class="name">.NetworkSettings.IPAddress</span> &#125;&#125;</span><span class="xml">&#x27; <span class="tag">&lt;<span class="name">container_name</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>或在通过 Dockerfile 构建镜像时，通过构建参数 (build argument) 传入：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">DOCKER_HOST_IP</span>=`ifconfig | grep -E <span class="string">&quot;([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;&quot;</span> | grep -v 127.0.0.1 | awk <span class="string">&#x27;&#123; print $2 &#125;&#x27;</span> | cut -f2 -d: | head -n1`</span><br><span class="line">echo DOCKER_HOST_IP = <span class="variable">$DOCKER_HOST_IP</span></span><br><span class="line">docker build \</span><br><span class="line">  --build-arg <span class="attribute">ARTIFACTORY_ADDRESS</span>=<span class="variable">$DOCKER_HOST_IP</span> </span><br><span class="line">  -t sometag \</span><br><span class="line">  some-directory/</span><br></pre></td></tr></table></figure>

<h3 id="获取端口映射"><a href="#获取端口映射" class="headerlink" title="获取端口映射"></a>获取端口映射</h3><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">docker inspect -f &#x27;</span><span class="template-variable">&#123;&#123;<span class="name">range</span> $p, $conf <span class="attr">:</span>= .NetworkSettings.Ports&#125;&#125;</span><span class="xml"> </span><span class="template-variable">&#123;&#123;<span class="name">$p</span>&#125;&#125;</span><span class="xml"> -&gt; </span><span class="template-variable">&#123;&#123;(<span class="name">index</span> $conf <span class="number">0</span>).HostPort&#125;&#125;</span><span class="xml"> </span><span class="template-variable">&#123;&#123;<span class="name">end</span>&#125;&#125;</span><span class="xml">&#x27; <span class="tag">&lt;<span class="name">containername</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="通过正则匹配容器"><a href="#通过正则匹配容器" class="headerlink" title="通过正则匹配容器"></a>通过正则匹配容器</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="constructor">$(<span class="params">docker</span> <span class="params">ps</span> -<span class="params">a</span> | <span class="params">grep</span> <span class="string">&quot;REGEXP_PATTERN&quot;</span> | <span class="params">cut</span> -<span class="params">f1</span> -<span class="params">d</span><span class="string">&quot; &quot;</span>)</span>; <span class="keyword">do</span> echo $i; <span class="keyword">done</span>`</span><br></pre></td></tr></table></figure>

<h3 id="获取环境变量配置"><a href="#获取环境变量配置" class="headerlink" title="获取环境变量配置"></a>获取环境变量配置</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> <span class="comment">--rm ubuntu env</span></span><br></pre></td></tr></table></figure>

<h3 id="强行终止运行中的容器"><a href="#强行终止运行中的容器" class="headerlink" title="强行终止运行中的容器"></a>强行终止运行中的容器</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker kill <span class="constructor">$(<span class="params">docker</span> <span class="params">ps</span> -<span class="params">q</span>)</span></span><br></pre></td></tr></table></figure>

<h3 id="删除所有容器（强行删除！无论容器运行或停止）"><a href="#删除所有容器（强行删除！无论容器运行或停止）" class="headerlink" title="删除所有容器（强行删除！无论容器运行或停止）"></a>删除所有容器（强行删除！无论容器运行或停止）</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> <span class="operator">-f</span> <span class="variable">$</span>(docker <span class="built_in">ps</span> <span class="literal">-qa</span>)</span><br></pre></td></tr></table></figure>

<h3 id="删除旧容器"><a href="#删除旧容器" class="headerlink" title="删除旧容器"></a>删除旧容器</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> ps -a | grep <span class="string">&#x27;weeks ago&#x27;</span> | awk <span class="string">&#x27;&#123;print <span class="variable">$1</span>&#125;&#x27;</span> | xargs docker rm</span><br></pre></td></tr></table></figure>

<h3 id="删除已停止的容器"><a href="#删除已停止的容器" class="headerlink" title="删除已停止的容器"></a>删除已停止的容器</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> <span class="literal">-v</span> `docker <span class="built_in">ps</span> <span class="literal">-a</span> <span class="literal">-q</span> <span class="operator">-f</span> status=exited`</span><br></pre></td></tr></table></figure>

<h3 id="停止并删除容器"><a href="#停止并删除容器" class="headerlink" title="停止并删除容器"></a>停止并删除容器</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop <span class="constructor">$(<span class="params">docker</span> <span class="params">ps</span> -<span class="params">aq</span>)</span><span class="operator"> &amp;&amp; </span>docker rm -v <span class="constructor">$(<span class="params">docker</span> <span class="params">ps</span> -<span class="params">aq</span>)</span></span><br></pre></td></tr></table></figure>

<h3 id="删除无用-dangling-的镜像"><a href="#删除无用-dangling-的镜像" class="headerlink" title="删除无用 (dangling) 的镜像"></a>删除无用 (dangling) 的镜像</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi <span class="constructor">$(<span class="params">docker</span> <span class="params">images</span> -<span class="params">q</span> -<span class="params">f</span> <span class="params">dangling</span>=<span class="params">true</span>)</span></span><br></pre></td></tr></table></figure>

<h3 id="删除所有镜像"><a href="#删除所有镜像" class="headerlink" title="删除所有镜像"></a>删除所有镜像</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi <span class="constructor">$(<span class="params">docker</span> <span class="params">images</span> -<span class="params">q</span>)</span></span><br></pre></td></tr></table></figure>

<h3 id="删除无用-dangling-的卷标"><a href="#删除无用-dangling-的卷标" class="headerlink" title="删除无用 (dangling) 的卷标"></a>删除无用 (dangling) 的卷标</h3><p>Docker 1.9 版本起：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume rm <span class="constructor">$(<span class="params">docker</span> <span class="params">volume</span> <span class="params">ls</span> -<span class="params">q</span> -<span class="params">f</span> <span class="params">dangling</span>=<span class="params">true</span>)</span></span><br></pre></td></tr></table></figure>

<p>1.9.0 中，参数 <code>dangling=false</code> 居然 <em>没</em> 用 - 它会被忽略然后列出所有的卷标。</p>
<h3 id="查看镜像依赖"><a href="#查看镜像依赖" class="headerlink" title="查看镜像依赖"></a>查看镜像依赖</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images -viz <span class="string">| dot -Tpng -o docker.png</span></span><br></pre></td></tr></table></figure>

<h3 id="Docker-容器瘦身"><a href="#Docker-容器瘦身" class="headerlink" title="Docker 容器瘦身"></a>Docker 容器瘦身</h3><ul>
<li>在某层 (RUN layer) 清理 APT</li>
</ul>
<p>这应当和其他 apt 命令在同一层中完成。<br>否则，前面的层将会保持原有信息，而你的镜像则依旧臃肿。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RUN &#123;apt commands&#125; \</span><br><span class="line">  &amp;&amp; apt-get clean \  </span><br><span class="line">  &amp;&amp; rm -rf <span class="regexp">/var/</span>lib<span class="regexp">/apt/</span>lists<span class="regexp">/* /</span>tmp<span class="regexp">/* /</span>var<span class="regexp">/tmp/</span>*</span><br></pre></td></tr></table></figure>

<ul>
<li><p>压缩镜像</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID=<span class="constructor">$(<span class="params">docker</span> <span class="params">run</span> -<span class="params">d</span> <span class="params">image</span>-<span class="params">name</span> <span class="operator">/</span><span class="params">bin</span><span class="operator">/</span><span class="params">bash</span>)</span></span><br><span class="line">docker export $ID <span class="pattern-match">| docker import – flat-image-name</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>备份</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ID=<span class="constructor">$(<span class="params">docker</span> <span class="params">run</span> -<span class="params">d</span> <span class="params">image</span>-<span class="params">name</span> <span class="operator">/</span><span class="params">bin</span><span class="operator">/</span><span class="params">bash</span>)</span></span><br><span class="line">(docker export $ID <span class="pattern-match">| gzip -c &gt; image.tgz)</span></span><br><span class="line"><span class="pattern-match">gzip -dc image.tgz | docker import - flat-image-name</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="监视运行中容器的系统资源利用率"><a href="#监视运行中容器的系统资源利用率" class="headerlink" title="监视运行中容器的系统资源利用率"></a>监视运行中容器的系统资源利用率</h3><p>检查某个容器的 CPU、内存以及网络 I/O 使用情况，你可以：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats <span class="tag">&lt;<span class="name">container</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>按 ID 列出所有容器：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats <span class="constructor">$(<span class="params">docker</span> <span class="params">ps</span> -<span class="params">q</span>)</span></span><br></pre></td></tr></table></figure>

<p>按名称列出所有容器：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats <span class="constructor">$(<span class="params">docker</span> <span class="params">ps</span> --<span class="params">format</span> &#x27;&#123;&#123;.Names&#125;&#125;&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>按指定镜像名称列出所有容器：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">ps</span> <span class="literal">-a</span> <span class="operator">-f</span> ancestor=ubuntu</span><br></pre></td></tr></table></figure>

<p>删除所有未标签命名 (untagged) 的容器：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi <span class="constructor">$(<span class="params">docker</span> <span class="params">images</span> | <span class="params">grep</span> “^” | <span class="params">awk</span> &#x27;&#123;<span class="params">split</span>($0,<span class="params">a</span>,<span class="string">&quot; &quot;</span>)</span>; print a<span class="literal">[<span class="number">3</span>]</span>&#125;&#x27;)</span><br></pre></td></tr></table></figure>

<p>通过正则匹配删除指定容器：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">ps</span> <span class="literal">-a</span> | grep wildfly | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs docker <span class="built_in">rm</span> <span class="operator">-f</span></span><br></pre></td></tr></table></figure>

<p>删除所有已退出 (exited) 的容器：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f <span class="constructor">$(<span class="params">docker</span> <span class="params">ps</span> -<span class="params">a</span> | <span class="params">grep</span> Exit | <span class="params">awk</span> &#x27;&#123; <span class="params">print</span> $1 &#125;&#x27;)</span></span><br></pre></td></tr></table></figure>

<h3 id="将文件挂载为卷标"><a href="#将文件挂载为卷标" class="headerlink" title="将文件挂载为卷标"></a>将文件挂载为卷标</h3><p>文件也可以被挂载为卷标。例如你可以仅仅注入单个配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从容器复制文件</span></span><br><span class="line">docker run --rm httpd cat /usr/<span class="built_in">local</span>/apache2/conf/httpd.conf &gt; httpd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑文件</span></span><br><span class="line">vim httpd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 挂载修改后的配置启动容器</span></span><br><span class="line">docker run --rm -ti -v <span class="string">&quot;<span class="variable">$PWD</span>/httpd.conf:/usr/local/apache2/conf/httpd.conf:ro&quot;</span> -p <span class="string">&quot;80:80&quot;</span> httpd</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpg" alt="Honng 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipay.jpg" alt="Honng 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Honng
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://yonghong.tech/tips/docker-cheat-sheet/" title="Docker Cheat Sheet">http://yonghong.tech/tips/docker-cheat-sheet/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="/atom.xml">
          <span class="icon">
            <i class="fa fa-rss"></i>
          </span>

          <span class="label">RSS</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/%E6%8A%80%E5%B7%A7/" rel="tag"># 技巧</a>
              <a href="/tags/%E9%80%9F%E6%9F%A5/" rel="tag"># 速查</a>
              <a href="/tags/Docker/" rel="tag"># Docker</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/tips/cheat-sheet/" rel="prev" title="速查">
                  <i class="fa fa-chevron-left"></i> 速查
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/tips/git-tips/" rel="next" title="Git 的奇技淫巧">
                  Git 的奇技淫巧 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-disqus">disqus</a></li>
            <li class="tab"><a href="#comment-gitalk">gitalk</a></li>
            <li class="tab"><a href="#comment-livere">livere</a></li>
            <li class="tab"><a href="#comment-utterances">utterances</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane disqus" id="comment-disqus">
              
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
            </div>
            <div class="tab-pane gitalk" id="comment-gitalk">
              <div class="comments gitalk-container"></div>
            </div>
            <div class="tab-pane livere" id="comment-livere">
              <div class="comments" id="lv-container" data-id="city" data-uid="MTAyMC81MTYxMi8yODA5Mw=="></div>
            </div>
            <div class="tab-pane utterances" id="comment-utterances">
              <div class="comments utterances-container"></div>
            </div>
        </div>
      </div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yonghong</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">1.4m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">21:46</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div><div>
由 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & <a target="_blank" rel="noopener" href="https://theme-next.js.org/">NexT.Gemini</a> & <a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" style="border: none;"><img src="/images/upyun.png" alt="又拍云" width="80px" style="display: inline; vertical-align: middle;"/></a>强力驱动
</div>
<div id="beian">
  <a href="https://beian.miit.gov.cn" rel="noopener external nofollow noreferrer" target="_blank" class="exturl" title="">京 ICP 备 18012168 号</a>
</div>
<script>
  var domain = document.domain;
  if (domain == 'localhost') {
    document.getElementById('beian').getElementsByTagName('a')[0].innerText = '京ICP备 18012168号';
  }
  if (domain == '0xl2oot.cn') {
    document.getElementById('beian').getElementsByTagName('a')[0].innerText = '京ICP备 18012168号-1';
  }
  if (domain == 'www.0xl2oot.cn') {
    document.getElementById('beian').getElementsByTagName('a')[0].innerText = '京ICP备 18012168号-1';
  }
  if (domain == 'yonghong.tech') {
    document.getElementById('beian').getElementsByTagName('a')[0].innerText = '京ICP备 18012168号-5';
  }
  if (domain == 'www.yonghong.tech') {
    document.getElementById('beian').getElementsByTagName('a')[0].innerText = '京ICP备 18012168号-5';
  }
</script>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/comments.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/next-boot.min.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/search/local-search.min.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.13.3/dist/mermaid.min.js","integrity":"sha256-blHXaX2RMvNwEOnrYOl/6/RKqNi97Ig3o6Ae3bhXPvM="}}</script>
  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/tags/mermaid.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/fancybox.min.js"></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/math/mathjax.min.js"></script>


  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.2.0/dist/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"http://yonghong.tech/tips/docker-cheat-sheet/"}</script>
  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/quicklink.min.js"></script>
<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"yonghong-tech","count":false,"i18n":{"disqus":"disqus"}}</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/comments/disqus.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"wangyonghong","repo":"gitalk","client_id":"0e42a09d2799751b9ba7","client_secret":"3e04e5109cf9e3cc34d68deb668842c9c5139846","admin_user":"wangyonghong","distraction_free_mode":true,"proxy":"https://codeyq.com/gitalk-proxy/login/oauth/access_token","language":null,"js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"},"path_md5":"3e1e2fdaf22986d90df83d944e1c8f76"}</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/comments/gitalk.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/comments/livere.min.js"></script>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"wangyonghong/gitalk","issue_term":"pathname","theme":"github-light"}</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.8.1/source/js/third-party/comments/utterances.min.js"></script>
<script src="//unpkg.com/rxjs/bundles/rxjs.umd.min.js"></script>
<script>
const { range } = rxjs;
const { map, filter, debounceTime } = rxjs.operators;

const shiftPress$ = rxjs.fromEvent(document, 'keydown')
  .pipe(
    filter(({ key }) => key === 'Shift')
  )
  

const shiftDoublePress$ = shiftPress$.pipe(debounceTime(600))

shiftDoublePress$.subscribe(count => {
  console.log('双击shift，激活搜索框')
  const event = new MouseEvent('click', {
    view: window,
    bubbles: true,
    cancelable: true
  })
  const searchDiv = document.getElementsByClassName('popup-trigger')[0];
  searchDiv.dispatchEvent(event)
})
</script>

</body>
</html>
